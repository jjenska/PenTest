# h7 Hash

Tehtävien tekemiseen käytettiin pöytäkonetta:

- Prosessori: AMD Ryzen 5 3600 6-Core Processor 3.59 GHz
- Kovalevy: 256 GB M.2 SSD, 512 GB SSD
- Muisti: 32GB RAM
- Käyttöjärjestelmä: Windows 10 Pro
- VirtualBox
  
Lisäksi virtuaalikone: Kali Linux

Tarkemmat tehtävänannot osoitteessa: *[terokarvinen.com](https://terokarvinen.com/2023/eettinen-hakkerointi-2023/#h7-hash)*

## x) Lue ja tiivistä. 
Karvinen 2022: Cracking Passwords with Hashcat
- ohjelmat: hashcat (salasanojen murtamiseen) ja hashid (hakemaan tiivisteen salausmenetelmän tyyppi)
- hyvä hyödyntää isoa sanakirjaa  (esim. GitHub danielmiessler: Leaked databases rockyou.txt, löytyy kalilta ```/usr/share/wordlists``` )
- määriteltävän tiivisteen tyyppiä voidaan analysoida komennolla ```hashid -m <tiiviste>```, listaa tulosteeksi vaihtoehdot
- ```-o <tiedostonimi>``` komennolla voidaan tallentaa murrettu tiiviste itse määriteltyyn tiedostoon
- eli komento kokonaisuudessaan ```hashcat -m 0 <tiiviste> rockyou.txt -o <tiedoston nimi>```, mikäli murtaminen onnistuu, voidaan tarkastella ```cat <tiedoston nimi>```
  
Lähde: *[Karvinen Tero - Cracking passwords with hashcat](https://terokarvinen.com/2022/cracking-passwords-with-hashcat/)*

Karvinen 2023: Crack File Password With John
- asennuksessa kalille huomioitava paketit build-essential (C compiler ja siihen liittyvät työkalut), libssl-dev (John:n vaatimukset), zlib1g zlib1g-dev zlib1g-gst (John:n ZIP support), libbz2-1.0 libbz2-dev (John:n 7zip support), atool zip (compression tools unpack/unzip)
- ```./configure``` muodostaa Makefilen ```make```-komentoa varten &rarr; mikäli ilmoittaa riippuvuuksien puuttumisesta, voidaan hyödyntää ```apt-cache search```
- compilation komennolla ```make -s clean && make -sj4``` (huom! vie muutaman gigan muistia, joten virtuaalikoneella hyvä olla sitä tarpeeksi varattuna)
- ```/run``` kansiosta löytyvät ajettavat skriptit
- voidaan hyödyntää esim. zip-tiedostoa, joka ensin muunnetaan ```zip2john esimerkki.zip  >esimerkki.zip.hash```, sitten laitetaan john hyökkäämään ```$home/john/run/john esimerkki.zip.hash```
- kun tiedoston salasana saadaan murrettua, voidaan zip tiedosto purkaa ```unzip esimerkki.zip``` & syöttämällä salasana

Lähde: *[Karvinen Tero - Cracking passwords with john](https://terokarvinen.com/2023/crack-file-password-with-john/)*

## a) Hashcat. Asenna Hashcat ja testaa sen toimivuus ratkaisemalla tiiviste.

Aloitin tehtävän tarvittavien ohjelmien asennuksella (hashid & hashcat):

```console
┌──(kali㉿kali)-[~]
└─$ sudo apt-get -y install hashid hashcat     
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
hashid is already the newest version (3.1.4-4).
hashid set to manually installed.
hashcat is already the newest version (6.2.6+ds1-1+b1).
hashcat set to manually installed.
0 upgraded, 0 newly installed, 0 to remove and 1195 not upgraded.
```
Asennuksen jälkeen loin kansion kyseistä tehtävää varten. Tarkistin kalilta, löytyykö Teron ohjeissa käytetty rockyou.txt sanalista jo valmiina. Ja löytyihän se, .gz pakattuna tiedostona:

```console
┌──(kali㉿kali)-[~]
└─$ ls /usr/share/wordlists 
amass  dirbuster      fern-wifi  legion      nmap.lst        sqlmap.txt  wifite.txt
dirb   fasttrack.txt  john.lst   metasploit  rockyou.txt.gz  wfuzz
```
Kopion tiedoston työkansiooni, ja purin sen käyttäen gzip:ä. Gzip:n man sivuilta löysin ohjeen, että ```-d``` suorittaa toiminnon pura (decompress). Poistin myös purkamisen jälkeen .gz tiedoston, jotta jäljelle jäi vain .txt.

```console
┌──(kali㉿kali)-[~/hashkissa]
└─$ cp /usr/share/wordlists/rockyou.txt.gz /home/kali/hashkissa 
                                                                                                  
┌──(kali㉿kali)-[~/hashkissa]
└─$ ls                                    
rockyou.txt.gz

┌──(kali㉿kali)-[~/hashkissa]
└─$ gzip -d rockyou.txt.gz 
                                                                                                  
┌──(kali㉿kali)-[~/hashkissa]
└─$ ls
rockyou.txt
```

Tarkastelemalla tiedoston kymmentä ensimmäistä riviä (```head rockyou.txt```), näytti sisältö vastaavalta kuin Teron ohjeissa. Sitten murtamaan, eli loin itse ensin esimerkkitiivisteen *[MD5 generaattorilla](https://www.md5hashgenerator.com/)*. 

```
482c811da5d5b4bc6d497ffa98491e38 (=password123)
```

Testasin toki vielä hashid toimintoa, joka analysoi tiivisteen tyypin, vaikka tiesin sen jo.

```console
┌──(kali㉿kali)-[~/hashkissa]
└─$ hashid -m 482c811da5d5b4bc6d497ffa98491e38
Analyzing '439c571c7f44df4cc1f355a445cea933'
[+] MD2 
[+] MD5 [Hashcat Mode: 0]
[+] MD4 [Hashcat Mode: 900]
[+] Double MD5 [Hashcat Mode: 2600]
# tulosteesta poistettu turhia rivejä 
```

Sitten lähdin murtamaan tiivistettä. ```-m 0``` kertoi tyypin (MD5: Mode 0) ja ```-o``` tiedoston, johon murrettu tiiviste kirjoitetaan (outfile), eli nimeämäni crackedpw.

```console
┌──(kali㉿kali)-[~/hashkissa]
└─$ hashcat -m 0 '482c811da5d5b4bc6d497ffa98491e38' rockyou.txt -o crackedpw
hashcat (v6.2.6) starting
# tulosteen rivejä poistettu
* Device #1: Not enough allocatable device memory for this attack.
# tulosteen rivejä poistettu
```

Murtaminen ei sujunutkaan ilman ongelmia. Virheviestiksi tuli ilmoitus, että koneellani ei ole tarpeeksi muistia allokoitavissa. Oletin, että koska kalini oli valmis VBox-paketti oletusasetuksilla, RAM-muistia oli liian vähän. 
Päätin siis sammuttaa koneen ja säätää sitä lisää. Valittuna oli reilu 2GB, jonka nostin 4GB (Machine "Settings" -> "System" -> "Base Memory").  Tämän jälkeen ohjelma näytti ajavan koko homman läpi, ja sain statukseksi "cracked". 

```console
┌──(kali㉿kali)-[~/hashkissa]
└─$ hashcat -m 0 '482c811da5d5b4bc6d497ffa98491e38' rockyou.txt -o crackedpw
hashcat (v6.2.6) starting
# tulosteen rivejä poistettu
Session..........: hashcat
Status...........: Cracked
Hash.Mode........: 0 (MD5)
Hash.Target......: 482c811da5d5b4bc6d497ffa98491e38
# tulosteen rivejä poistettu
```
Testasin ohjelmaa sekä Teron ohjeissa olleen esimerkin, että oman esimerkin kanssa. Tiedostoon tallentuivat molemmat onnistuneet murrot.

```console
┌──(kali㉿kali)-[~/hashkissa]
└─$ cat crackedpw 
6b1628b016dff46e6fa35684be6acc96:summer
482c811da5d5b4bc6d497ffa98491e38:password123
```

## b) John. Asenna Jumbo John ja testaa sen toimivuus murtamalla jonkin tiedoston salasana.

Aloitin tehtävän asentamalla tarvittavat ohjelmat ja riippuvuudet. Poistin ohjeiden komennosta ohjelmat, jotka minulla oli jo asennettuna. Asensin siis build-essential, libssl-dev, zlib1g, zlib1g-dev, zlib-gst, libbz2-1.0, libbz2-dev, atool. Asennus ilmoitti, että
zlib-gist:ä ei löydy. Tuloste näytti myös siltä, että vain vähän paketteja asennettiin. Ajattelin tämän johtuvan siitä, että kalissa ohjelmia tulee paljon valmiina, Teron ohjeen asennukset taas oli tehty Debian 11:lle. Jatkoin siis tässä vaiheessa eteenpäin. 
Kloonasin john:n repon GitHubista.

```console
┌──(kali㉿kali)-[~/ripperi]
└─$ git clone --depth=1 https://github.com/openwall/john.git
Cloning into 'john'...
remote: Enumerating objects: 2058, done.
remote: Counting objects: 100% (2058/2058), done.
remote: Compressing objects: 100% (1836/1836), done.
remote: Total 2058 (delta 433), reused 726 (delta 216), pack-reused 0
Receiving objects: 100% (2058/2058), 43.14 MiB | 13.38 MiB/s, done.
Resolving deltas: 100% (433/433), done.
```

Tämän jälkeen lähdin asentamaan ohjelmaa.

```console
┌──(kali㉿kali)-[~/ripperi/john/src]
└─$ ./configure 
checking build system type... x86_64-unknown-linux-gnu
# ylimääräisiä rivejä poistettu
checking supplied paths for OpenSSL...  
checking additional paths for OpenSSL... none
checking openssl/opensslv.h usability... no
checking openssl/opensslv.h presence... no
checking for openssl/opensslv.h... no
configure: error: in `/home/kali/ripperi/john/src':
configure: error: OpenSSL headers not found, install them or use --without-openssl option
See `config.log' for more details
```

Sainkin yhden virheen, jonka mukaan OpenSSL headereitä ei löytynyt. Tarkastelin aikaisempia asennuksia, ja kokeilin ajaa vielä ```sudo apt-get -y install libssl-dev``` uudelleen. Tämä näytti menevän läpi ilman virheitä, joten kokeilin uudelleen ```./configure```. 
Nyt kaikki raksutti ilman sen kummempia ongelmia. En tosin ymmärtänyt, miksi kyseinen komento ei todennäköisesti asentanut mitään aikaisemmin. Tällä kertaa asennus päättyi ilman virhettä, ja sain loppuun ilmoituksen:

```console
┌──(kali㉿kali)-[~/ripperi/john/src]
└─$ ./configure
checking build system type... x86_64-unknown-linux-gnu
checking host system type... x86_64-unknown-linux-gnu
# tarpeettomia rivejä poistettu
Install missing libraries to get any needed features that were omitted.

Configure finished.  Now "make -s clean && make -sj4" to compile.
```
Tulosteen lopussa oli vielä taulukko, jossa luki "optional libraries/features". Osaa näistä ei ollut asennettu, mutta en uskonut sen vaikuttavan tehtävässä tarvittaviin ominaisuuksiin. Tämän jälkeen käänsin (compile) ohjelman tulosteeseen annetulla komennolla. 
Tässä vaiheessa sain nipun varoituksia, mutta päätin sivuuttaa ne toistaiseksi, ja testata ensin toimisiko ohjelma. Loppuun kuitenkin tuli ilmoitus "Make process completed.".

```console
┌──(kali㉿kali)-[~/ripperi/john/src]
└─$ make -s clean && make -sj4
# rivejä poistettu        
pkcs12_plug.c:605:17: warning: ‘pkcs12_fill_buffer_simd’ accessing 26880 bytes in a region of size 64 [-Wstringop-overflow=]
# ... 
# tulosteen rivejä poistettu
/usr/bin/ar: creating poly1305-donna.a
/usr/bin/ar: creating ed25519-donna.a
/usr/bin/ar: creating secp256k1.a

Make process completed.
```

Kokeilin siis käynnistää john:n, ja se näytti toimivan:

```console
┌──(kali㉿kali)-[~/ripperi/john/run]
└─$ john
Created directory: /home/kali/.john
John the Ripper 1.9.0-jumbo-1+bleeding-aec1328d6c 2021-11-02 10:45:52 +0100 OMP [linux-gnu 64-bit x86_64 AVX2 AC]
Copyright (c) 1996-2021 by Solar Designer and others
Homepage: https://www.openwall.com/john/

Usage: john [OPTIONS] [PASSWORD-FILES]

Use --help to list all available options.
```

Sitten nappasin Teron esimerkki zip-tiedoston wget:llä ja kokeilin avata sen. Ilman oikeaa salasanaa se ei tietenkään onnistunut:

```console
┌──(kali㉿kali)-[~/ripperi/john/run]
└─$ unzip tero.zip 
Archive:  tero.zip
   creating: secretFiles/
[tero.zip] secretFiles/SECRET.md password: 
password incorrect--reenter: 
```
                                                                                       
Ensin tiedosto piti muuntaa muotoon, jonka ohjelma ymmärtää, eli tero.zip.hash.

```console
┌──(kali㉿kali)-[~/ripperi/john/run]
└─$ zip2john tero.zip >tero.zip.hash 
ver 1.0 tero.zip/secretFiles/ is not encrypted, or stored with non-handled compression type
ver 2.0 efh 5455 efh 7875 tero.zip/secretFiles/SECRET.md PKZIP Encr: TS_chk, cmplen=183, decmplen=217, crc=4C752C85 ts=572B cs=572b type=8
```
Sen jälkeen ajoin tiedoston ohjelmalla, jotta se suorittaa sanakirjahyökkäyksen:

```console
┌──(kali㉿kali)-[~/ripperi/john/run]
└─$ john tero.zip.hash 
Using default input encoding: UTF-8
Loaded 1 password hash (PKZIP [32/64])
Will run 2 OpenMP threads
Proceeding with single, rules:Single
Press 'q' or Ctrl-C to abort, almost any other key for status
Almost done: Processing the remaining buffered candidate passwords, if any.
Proceeding with wordlist:/usr/share/john/password.lst
butterfly        (tero.zip/secretFiles/SECRET.md)     
1g 0:00:00:00 DONE 2/3 (2023-12-07 12:46) 16.66g/s 1064Kp/s 1064Kc/s 1064KC/s 123456..Peter
Use the "--show" option to display all of the cracked passwords reliably
Session completed. 
```

Sieltä löytyi murrettu salasana butterfly.

## c) f5bc7fcc7f5b3b6af7ff79e0feafad6d1a948b6a2c18de414993c1226be48c1f on erään tällä tehtäväsivulla olevan yksittäisen sanan tiiviste. Käytin hyvin yleistä ja tunnettua tiivistealgoritmia. Sanassa voi olla isoja kirjaimia, mutta ei erikoismerkkejä. Minkä sanan tiiviste on kyseessä?

Päätin lähestyä tehtävää niin, että kokeilen ohjelmaa cewl, joka nousi esiin maanantain tunnilla. Ohjelma vaikutti melko suoraviivaiselta. Päätin, että testaan myös pythonia, mikäli minulle jää aikaa. Asensin cewl:n kalilleni ja tarkastelin man sivulta, miten ohjelmaa oikein käytetään. 

```console
sudo apt-get -y install cewl
```

Sieltä selvisi, että cewl:ssa perus komento sanakirjan luomiselle on cewl + url:

```console
cewl https://example.com
```

Halusin luoda tehtäväsivun sanoista tiedoston, tähän löytyikin erikseen ```-w```, eli "write the output to the file" (man cewl). Lähdin siis testamaan koko hommaa komennolla:

```console
┌──(kali㉿kali)-[~/hashkissa]
└─$ cewl https://terokarvinen.com/2023/eettinen-hakkerointi-2023/ -w kaikkisanat.txt
```

Ohjelma lähti pyörimään, mutta vaikutti siltä, että se jäi jumittamaan, eikä pysähtynyt ollenkaan. Tovin odottelun jälkeen,  kokeilin keskeyttää homman ```ctrl``` + ```c```. Tämän jälkeen katsoin, oliko ohjelma kirjoittanut tiedostoon mitään  (```cat kaikkisanat.txt ```). 
Jumiutumisesta huolimatta cewl oli pureksinut valtavan määrän sanoja. Ohjelma oli pätkäissyt kaikki sanat automaattisesti, ilman että niihin jäi välilyöntejä tai tarpeettomia merkkejä, kuten "," ja ".". 
Se toimi yllättävän hyvin suomenkielisiinkin sanoihin, eli oletettavasti sanat katkaistiin välilyöntien kohdista. Koska sivustolla oli paljon tekstiä, epäilin, että ohjelma jumitti vain tiedon määrästä.
Päätin siis kokeilla komennon vielä uudelleen, poistin toki ensin aikaisemman kaikkisanat.txt tiedoston. Tällä kertaa päätin odotella vähän pidempään ohjelman raksutusta. Homma menikin kokonaan läpi:

```console                                                                                               
┌──(kali㉿kali)-[~/hashkissa]
└─$ cewl https://terokarvinen.com/2023/eettinen-hakkerointi-2023/ -w kaikkisanat.txt
CeWL 6.1 (Max Length) Robin Wood (robin@digi.ninja) (https://digi.ninja/)
```

Sisältö tosin oli vähintäänkin mielenkiintoinen:

```console
┌──(kali㉿kali)-[~/hashkissa]
└─$ tail kaikkisanat.txt 
huviksesi
huoli
joudu
pyörittelemään
peukaloita
lahjatietokanta
kaikesta
iloinen
piditte
kehitysideat
```

Kokeilin hakea (```ctrl + f```) tehtäväsivulta esim. sanaa "peukaloita", enkä löytänyt sille vastinetta. Ilmeisesti cewl käy laajemmin koko verkkosivun endpointit/linkit läpi? Tähän en perehtynyt tarkemmin.
Heräsi tosin pieni epäilys, että toimiikohan homma, mutta siirryin joka tapauksessa hashcatin pariin. Ensin testasin, millaista tyyppiä tiiviste voisi olla, pituutensa puolesta se ei viitannut MD5:een.

```console
┌──(kali㉿kali)-[~/hashkissa]
└─$ hashid -m 'f5bc7fcc7f5b3b6af7ff79e0feafad6d1a948b6a2c18de414993c1226be48c1f'
Analyzing 'f5bc7fcc7f5b3b6af7ff79e0feafad6d1a948b6a2c18de414993c1226be48c1f'
[+] Snefru-256 
[+] SHA-256 [Hashcat Mode: 1400]
[+] RIPEMD-256 
[+] Haval-256
# tulosteen rivejä poistettu
````
Epäilin tyypiksi SHA-256, koska se on yleisesti käytössä oleva, ja nousi esiin myös maanantain tunnilla. Hash-tyypiksi lisäsin siis 1400, ja sanalistaksi valitsin luomani kaikkisanat.txt.

```console                                                                                                  
┌──(kali㉿kali)-[~/hashkissa]
└─$ hashcat -m 1400 'f5bc7fcc7f5b3b6af7ff79e0feafad6d1a948b6a2c18de414993c1226be48c1f' kaikkisanat.txt -o crackedpw
hashcat (v6.2.6) starting
# poistettu tarpeettomia rivejä tulosteesta
Dictionary cache built:
* Filename..: kaikkisanat.txt
* Passwords.: 18379
# ...                                                   
Session..........: hashcat
Status...........: Cracked
Hash.Mode........: 1400 (SHA2-256)
Hash.Target......: f5bc7fcc7f5b3b6af7ff79e0feafad6d1a948b6a2c18de41499...e48c1f
# poistettu tarpeettomia rivejä tulosteesta
```

Tulosteen mukaan salasana oli murrettu. Kurkistin tiedostoon, johon olin sen tallentanut.

```console                                                                                                  
┌──(kali㉿kali)-[~/hashkissa]
└─$ cat crackedpw      
6b1628b016dff46e6fa35684be6acc96:summer
482c811da5d5b4bc6d497ffa98491e38:password123
f5bc7fcc7f5b3b6af7ff79e0feafad6d1a948b6a2c18de414993c1226be48c1f:Sertificate
```
Sieltä se löytyi viimeisimpänä, eli "Sertificate".

# d) Cheatsheet. Kerää kurssilaisten raporteista käteviä tekniikoita. Kerää itse tekniikat ja komennot, älä pelkästään kuvaile. Muista lähdeviitteet.

### Nmap skannaus
- porttiskannaus haluttuun IP-avaruuteen
- ajetaan komennot sudona (```sudo nmap```)
- ```-sV <IP-osoite>``` versioiden skannaamiseen, päästään käsiksi mahdollisiin haavoittuvuuksiin
- ```-p-``` kaikki portit
- ```-oA <tiedoston nimi>``` kirjoittaa skannauksen tiedot tiedostoon (gnmap, nmap ja xml)
- hostien skannaus ping sweepillä ```-sn```
- lokitiedoista voi olla hyötyä (esim. Apache2 -> /var/log/apache2/access.log)

Lähde: *[GitHub - Sawulohi](https://github.com/sawulohi/PenTest/blob/main/h2/README.md)*

### Ffuf
- piilotettujen hakemistojen nopea etsiminen hyödyntäen sanalistoja 
- ```ffuf -w common.txt -u http://example.com/FUZZ -c``` (sanakirja (-w), url (-u), värit (-c))
- ```-f``` filtteröi vastauskoodit, voidaan yhdistää ```-fc 200```
- ```-e .log``` lisätään sanakirjan sanoihin tiedostopäätteet .log
- ```-fs``` suodatus koon mukaan
- 
Lähde: *[GitHub - JanaHalt](https://github.com/JanaHalt/Ethical-Hacking-2023/blob/7acd5e9148d6d01ece3d9f0b8cd0f58540eb2c61/h2%20Sniff-n-Scan.md)*

### Exploits
- ```searchsploit <hakusana>``` Kalissa valmiina exploittien etsimiseen
- ExploitDB myös verkossa

Lähde: *[GitHub - JanaHalt](https://github.com/JanaHalt/Ethical-Hacking-2023/blob/7acd5e9148d6d01ece3d9f0b8cd0f58540eb2c61/h3%20Lab%20kid.md)*

### Välimiesproxy
- HTTP liikenteen kaappaus
- ZAP + foxyproxy
- sertifikaatin luominen: Tools -> Options -> Network -> Server Certificates -> Generate
- selaimessa: Settings -> Privacy & Security -> Certificates -> View Certificates

Lähde: *[GitHub - JanaHalt](https://github.com/JanaHalt/Ethical-Hacking-2023/blob/7acd5e9148d6d01ece3d9f0b8cd0f58540eb2c61/h4%20Totally%20Legit%20Sertificate.md)*

# Lähteet:

[GitHub - JanaHalt](https://github.com/JanaHalt/Ethical-Hacking-2023/blob/7acd5e9148d6d01ece3d9f0b8cd0f58540eb2c61/h2%20Sniff-n-Scan.md)

[GitHub - Sawulohi](https://github.com/sawulohi/PenTest/blob/main/h2/README.md)

[Karvinen Tero - h7](https://terokarvinen.com/2023/eettinen-hakkerointi-2023/#h7-hash)

[Karvinen Tero - Cracking passwords with hashcat](https://terokarvinen.com/2022/cracking-passwords-with-hashcat/)

[Karvinen Tero - Cracking passwords with john](https://terokarvinen.com/2023/crack-file-password-with-john/)

[MD5 Hash Generator](https://www.md5hashgenerator.com/)

Man cewl

Man zip
