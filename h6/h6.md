# h6 Attaaack

Tehtävien tekemiseen käytettiin pöytäkonetta:

- Prosessori: AMD Ryzen 5 3600 6-Core Processor 3.59 GHz
- Kovalevy: 256 GB M.2 SSD, 512 GB SSD
- Muisti: 32GB RAM
- Käyttöjärjestelmä: Windows 10 Pro
- VirtualBox
  
Lisäksi virtuaalikoneita: Kali Linux (valmis paketti, oletusasetuksilla), Metasploitable2

Tarkemmat tehtävänannot osoitteessa *[terokarvinen.com](https://terokarvinen.com/2023/eettinen-hakkerointi-2023/#h6-attaaack)*
## x) Lue/katso/kuuntele ja tiivistä. 

Yehoshua and Kosayev 2021: Antivirus Bypass Techniques, luku: Chapter 1: Introduction to the Security Landscape
- haittaohjelmia on lukuisia: esim. virukset, madot, piilohallintaohjelmat, kiristysohjelmat...
- ohjelmat voivat toteuttaa useaa eri määritelmää:
    - esim. kiristysohjelman päätarkoitus on salakirjoittaa käyttäjän tiedostot lunnaita vastaan
    - ohjelma voi toimia myös troijalaisena ja matona, mikäli se pystyy liikkumaan verkossa sivusuuntaisesti saastuttaen muita koneita (esimerkkinä kirjassa WannaCry)
- Antivirusohjelman lisäksi käyttäjää/yritystä voidaan suojata useilla menetelmillä:
    - EDR (endpoint detection and response): reaaliaikaiset vastaukset jokaisesta tapahtumasta, joka määritellään haitalliseksi
    - palomuuri: verkossa tapahtuvien uhkien monitorointi, esto ja tunnistaminen perustuen ennalta määrättyihin käytäntöihin
    - IDS/IPS (intrusion detection system/intrusion prevention system): tutkitaan verkkotason paketteja, ja etsitään haitallisia polkuja/kaavoja
    - DLP (data loss prevention): pysäytetään ja raportoidaan, mikäli arkaluontoista dataa on vuotamassa valtuuttamattomille tahoille
- antivirusohjelmat voidaan luokitella: static, dymanic, heuristic ja unpacking
- staattinen heikoin, vertaa käyttöjärjestelmän tiedostoja (.EXE,.DLL jne.) tietokannan sisältämiin "signatuureihin", ja sitä kautta tunnistaa haittoja
- heuristic edistynyt, määrittelee tiedostoille tuloksen/pistemäärän (score) keräämällä tilastollista analyysiä, joka yhdistää staattisen ja dyynaamisen keinot
- antivirusohjelma voidaan kiertää TCP-protokollaa hyödyntäen reverse shell ja blind shell keinoin (kyseisen kirjan testaus tehty lähiverkossa)
    - reverse shell: hyökkääjän koneelle määritellään portti, joka on auki C2 serverillä, haittaohjelma toimii clientina, joka avaa yhteyden hyökkääjän C2 serverille käyttäen sattumanvaraista porttia, joka avataan kohteen päässä  

*LÄHDE*

Halonen, Rajala ja Ollikainen 2023: PhishSticks Youtube Channel, kahdeksan videota, yhteensä noin 15 min
- haittaohjelman testaaminen sovelluskansion sisällä: listataan tiedostot ja avataan .txt ja .jpg &rarr; ajetaan python skripti, jonka jälkeen kaikki tiedotot on salakirjoitettu
- digisparkin testaaminen: laitteen asettaminen koneeseen käynnistää haittaohjelman automaattisesti, joten tiedostot Documents-kansiossa salataan
- keyloggerin testaaminen: käyttäen digisparkia injektoidaan komento, joka lataa uhrin koneella PowerShell skriptin ja ajaa sen taustalla, tämä tekee automaattisesti POST pyynnön etäserverille log-tiedoston sisällöstä &rarr; pyyntö hyväksytään ja tiedot tallennetaan

Halonen, Rajala ja Ollikainen 2023: PhishSticks Git Repository, sivut:
README.md
...
  
Revshell
- Company raport tiedosto on linkitetty piilotettuun kansioon payload\
  &rarr; raportti avataan, jolloin ladataan netcat hyökkääjän IP-osoitteesta\
  &rarr; reverse shell käynnistetään
  
Mitigations
- PowerShellin käytön pois päältä kytkeminen estää Digisparkin hyötykuormien ajon:
    &rarr; User Configurations välilehdeltä Administrative Templates ja System voidaan asettaa mitä Windows sovelluksia ei ajeta
- Voidaan myös asettaa Windowsin palomuurin sääntöihin, jolloin ajo estetään
- Tehokas tapa on kytkeä "Run" pois päältä käyttäjällä, tämä mahdollistaa silloin PowerShellin käytön
  
Installing Windows 10 on a virtual machine
- Microstoftin sivuilta mahdollista ladata .iso tiedosto
- versioksi Windows 10 (64-bit)
- VirtualBox Disk Image kovalevyn tyypiksi ja dynamically allocated
- prosessoreiden määräksi väh. 4 kpl
- custom asennus ja domain join ilman Microsoft käyttäjätiliä

*[Halonen, Rajala ja Ollikainen - PhishSticks](https://github.com/therealhalonen/PhishSticks/)*

MITRE Att&ck Frequently Asked Questions: Part 1. General.

- ATT&CK on tietoalusta kyberhyökkääjien toiminnasta, keskittyy dokumentoimaan toimet ja käyttäytymisen koko kyberhyökkäyksen elinkaaren ajan
- Enterprise keskittyy yritysverkkoihin ja pilveen kohdistuvaan toimintaan, Mobile mobiililaitteisiin kohdistuvaan
- tactics (toimenpiteet/taktiikat) = keskittyvät kuvaamaan miksi hyökkääjällä on tietty suoritustapa tai sen aliluokka &rarr; on syy suorittaa tietty toimi, jotta päästään tavoitteeseen
- techniques (suoritustavat/tekniikat) = keskittyvät kuvaamaan miten hyökkääjä saavuttaa toimenpiteensä (tactic) maalin (esim. aktiivinen skannaaminen)
- prosedures (menetelmät) = keskittyvät kuvaamaan tiettyä suoritustavan tai sen aliluokan toteutusta, jota hyökkääjä käyttää\
    &rarr; esim. Volatile Cedar on käyttänyt DirBusteria ja GoBusteria brute force hyökkäämällä web hakemistoihin ja DNS aliverkkotunnuksiin (subdomains)

MITRE Att&ck Enterprise Matrix (muutama esimerkki)
- Persictense: Modify Authentication Process (T1556):
    - hyökkääjät voivat muokata autentikointi menetelmiä ja prosesseja päästäkseen käsiksi käyttäjätunnuksiin, menetelmiä ovat mm. Windowsilla LSASS (Local Security Authentication Server) ja SAM (Security Accounts Manager)
    - 8 alitekniikkaa: Domain Controller Authentication, Password Filter DLL, Network Device Authentication, Reversible Encryption, Multi-Factor Authentication, Hybrid Identity, Network Provider DLL
    - hyökkääjistä Ebury voi siepata yksityisiä avaimia käyttämällä ssh-add funktiota (trojanized)
    - estokeinoja esim. monivaiheinen tunnistus

## a) Asenna Windows virtuaalikoneeseen samaan verkkoon hyökkäyskoneen kanssa. Kokeile, että saat koneen irrotettua Internetistä.

Seurasin asennuksessa Ollikaisen PhisSticks repon *[ohjeita](https://github.com/therealhalonen/PhishSticks/blob/master/notes/ollikainen/windows.md)*.

Aloitin lataamalla ISO-tiedoston (Enterprise downloads: English Great Britain, 64-bit) Microsoftin *[sivuilta](https://www.microsoft.com/en-us/evalcenter/download-windows-10-enterprise).

jatkuu...

## b) Kokeile PhishSticksin revshell vihamielistä tiedostoa, joka avaa käänteisen shellin hyökkääjän koneelle. Selitä, mitä tapahtuu ja miksi. Testaa, että pysyt antamaan kohdekoneelle komentoja reverse shellin kautta.
## d) Laita linkki raporttiisi kurssisivun kommentiksi.
## c) MITRE Attack Enterprise Matrix: Demonstroi viisi tekniikkaa viidestä eri taktiikasta. (Nimeä käytetyt taktiikat, tekniikat ja alitekniikat. Merkitse myös niiden numerot)

### Taktiikkana Recoinnaissance

#### Tekniikkana Active Scanning

#### T1595.001	Scanning IP Blocks
#### T1595.002	Vulnerability Scanning
#### T1595.003	Wordlist Scanning

#### Tekniikkana Gather Victim Identity Information
#### T1589.001	Credentials

### Taktiikkana Credential Access

#### T1110 Brute force
#### T1110.001	Password Guessing
#### T1110.002	Password Cracking

#### T1539 Steal Web Session Cookie

# Lähteet:

[Karvinen Tero - h6](https://terokarvinen.com/2023/eettinen-hakkerointi-2023/#h6-attaaack)

[Halonen, Rajala ja Ollikainen - PhishSticks](https://github.com/therealhalonen/PhishSticks/)

[Ollikainen - PhishSticks: installing Windows 10 on a virtual machine](https://github.com/therealhalonen/PhishSticks/blob/master/notes/ollikainen/windows.md)
