# h4 Totally Legit Certificate

Tehtävien tekemiseen käytettiin pöytäkonetta:

- Prosessori: AMD Ryzen 5 3600 6-Core Processor 3.59 GHz
- Kovalevy: 256 GB M.2 SSD, 512 GB SSD
- Muisti: 32GB RAM
- Käyttöjärjestelmä: Windows 10 Pro
- VirtualBox

Lisäksi virtuaalikonetta: Kali Linux (valmis paketti, oletusasetuksilla)

Tarkemmat tehtävänannot osoitteessa: *[terokarvinen.com](https://terokarvinen.com/2023/eettinen-hakkerointi-2023/#h4-totally-legit-sertificate)*

## x) Lue/katso ja tiivistä.

OWASP 2021: OWASP Top 10:2021: A01:2021 – Broken Access Control (IDOR ja path traversal ovat osa tätä)
- periaatteena, että käyttäjät eivät voi toimia käyttöoikeuksiensa ulkopuolella
- epäonnistuminen voi johtaa luvattomaan tiedonsaantiin, tiedon muokkaamiseen tai tuhoamiseen, tai liiketoimintaan liittyvien toimintojen suorittamiseen ilman valtuutusta
- tyypillisiä haavoittuvuuksia mm. toimintaperiaatteen laiminlyöminen (käyttäjille ei jaettu rooleja, vaan laajemmat oikeudet automaattisesti kaikilla), oikeuksien sivuuttaminen muokkaamalla esim. URL:a (parametrien peukalointi)
- muutama esimerkki, miten ehkäistä:
    - sisäänpääsyn valvonnan tekniikoiden toteutus ja hyödyntäminen uudelleen verkkosovelluksen koko elinkaaren aikana
    - verkkopalvelimen hakemistolistausten estäminen
    - varmistus, että versionhallinta (esim. .git) ja varmuuskopiointi ei löydy verkkopalvelun juuresta (root)
    - rajapinnan pyyntöjen määrän rajoitus

*[OWASP - Broken Access Control](https://owasp.org/Top10/A01_2021-Broken_Access_Control/)*

OWASP 2021: OWASP Top 10:2021: A10:2021 – Server-Side Request Forgery (SSRF)
- tapahtuu, kun verkkosovellus noutaa resursseja etälähteestä validoimatta käyttäjän syöttämää URL:a\
    &rarr; mahdollistaa hyökkääjän pakottamaan sovelluksen lähettämään tekaistun pyynnön odottamattomaan kohteeseen, vaikka käytössä olisi palomuuri tai VPN
- muutama esimerkki, miten ehkäistä:
    - verkkokerroksessa esim. verkkojen segmentointi erillisiksi, jotta vapaata liikkumista voidaan estää jonkun sisään murtautuessa
    - palomuurilla rajattu kaikki ulkopuolinen verkkoliikenne, pakollista sisäverkossa tapahtuvaa liikennettä lukuunottamatta
    - sovelluskerroksessa kaiken asiakasohjelman syöttödatan siistiminen ja validoiminen
    - HTTP uudelleenohjausten estäminen\

*[OWASP - Serve-Side Request Forgery](https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29/)*

PortSwigger Academy:

Access control vulnerabilities and privilege escalation (IDOR on osa tätä):
- määrittelee, mikäli käyttäjällä on oikeus aikomansa toiminnon suorittamiseen
- voidaan jakaa eri alakategorioihin: vertical access controls, horizontal access controls ja context-dependent access controls
- pystysuorassa mallissa (vertical) pääsynhallinta arkaluontoisiin toimintoihin on rajattu tietyntyyppisille käyttäjille (pääkäyttäjä vs. tavallinen käyttäjä)\
  &rarr; haavoittuvuus: esim. `https://example.com/admin` polkuun onkin tavallisella käyttäjällä selailumahdollisuus\
  &rarr; haavoittuvuus: jotkut sovellukset määrittelevät käyttäjän roolin ja varastoivat sen piilotettuun kenttään, keksiin tai esiasetettuun kyselyparametriin, jota voi manipuloida: `https://example.com/login/home.jsp?admin=true`
- vaakasuorassa mallissa (horizontal) pääsynhallinta on rajattu tiettyjen käyttäjien resursseihin (esim. pankkisovellus, jossa rahaa voidaan siirtää vain omilta tileiltä, ei toisen käyttäjän)\
  &rarr; haavoittuvuus: käyttäjä voi katsella esim. omia pankkitietojaan käyttäen osoitetta `https://example.com/myaccount?id=123`, tässä `id` voidaan muuttaakin toisen käyttäjän arvoksi, jolla päästään sisään toisen pankkitietoihin
- asiayhteyteen sidotussa mallissa (context-dependent) pääsynhallinta on rajattu toiminallisuuksiin ja resursseihin, jotka perustuvat sovelluksen tilaan tai miten käyttäjä 
on vuorovaikutuksessa sen kanssa (esim. toimintojen tekeminen väärässä järjestyksessä ei onnistu, maksettua tuotetta ei pysty enää muokkaamaan)

*[Portswigger - Access Control](https://portswigger.net/web-security/access-control)*

Server-side template injection
- ...

Server-side request forgery (SSRF)
- tyypillisessä hyökkäyksessä hyökkääjä saattaa saada palvelimen luomaan yhteyden yrityksen infran sisäisiin palveluihin
- esim. kun verkkosivulta tehdään pyyntö tarkastella jonkin tuotteen varastosaldoa, palvelin lähettää pyyntöjä eri back-end REST rajapintoihin\
  &rarr; POST-pyyntöä voidaankin muokata `stockApi=http://localhost/admin`\
  &rarr; nyt pyyntö tulee paikalliselta koneelta, joten sovellus antaakin pääkäyttäjäoikeudet luotettuaan pyynnön lähteeseen\
  &rarr; jos paikallisen koneen pyyntöjä kohdellaan eri tavoin kuin normaaleja pyyntöjä, SSRF muuttuu kriittiseksi haavoittuvuudeksi

*[Portswigger - Server-side Request Forgery](https://portswigger.net/web-security/ssrf)*

Cross-site scripting
- ...

Karvinen 2020: Using New Webgoat 2023.4 to Try Web Hacking:
- sovellus, jolla voidaan harjoitella tunkeutumistestausta
- javan asennus mahdollistaa käytön, palomuurin asennus suojaksi
- Webgoat:n viimeisin versio löytyy GitHub:sta
- mikäli käytössä välimiesproxy, hyvä muuttaa portiksi joku toinen ennen käynnistämistä, esim. 8081

## Lähteet:

[OWASP - Broken Access Control](https://owasp.org/Top10/A01_2021-Broken_Access_Control/)

[OWASP - Serve-Side Request Forgery](https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29/)

[Portswigger - Access Control](https://portswigger.net/web-security/access-control)

[Portswigger - Server-side Request Forgery](https://portswigger.net/web-security/ssrf)

[Tero Karvinen - h4 Totally Legit Certificate](https://terokarvinen.com/2023/eettinen-hakkerointi-2023/#h4-totally-legit-sertificate)
