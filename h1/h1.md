# h1

Tehtävien tekemiseen käytettiin pöytäkonetta:

- Prosessori: AMD Ryzen 5 3600 6-Core Processor 3.59 GHz
- Kovalevy: 256 GB M.2 SSD, 512 GB SSD 
- Muisti: 32GB RAM 
- Käyttöjärjestelmä: Windows 10 Pro
- VirtualBox

ja virtuaalikonetta:
- Käyttöjärjestelmä: Debian 12
- Muisti: 4000MB
- Koko: 60GB

Aloitin tehtävien teon kohdasta d) asentamalla ensin virtuaalikoneen, jonka jälkeen siirryin kohtiin e)-h) ja a)-c).
Kaikkien tehtävien tarkemmat tehtävänannot löytyvät osoitteesta: [https://www.terokarvinen.com](https://terokarvinen.com/2023/eettinen-hakkerointi-2023/#h1-hacker-warmup)

## Tehtävät
### x) Lue/katso ja tiivistä: 
1. Santos et al: The Art of Hacking (Video Collection): [..] 4.3 Surveying Essential Tools for Active Reconnaissance, 5 videota.
     - porttiskannaus on yksi aktiivisen tiedustelun tärkeimmistä välineistä
     - auttaa selvittämään, mitkä palvelut ovat ylhäällä
     - välineitä mm. Nmap (monipuolisin ja vakain), Masscan (nopein, jos laajat IP-skannaukset) ja Udpprotoscanner (udp-paketit)
  
2. Hutchins et al 2011: Intelligence-Driven Computer Network Defense Informed by Analysis of Adversary Campaigns and Intrusion Kill Chains, chapters Abstract, 3.2 Intrusion Kill Chain.
    - kehittyneemmät uhkat APT (Advanced persistent threat), joissa hyvät resurssit ja koulutetut viholliset
    - APT:t vuosittain toistuvia tunkeutumisoperaatioita, joiden kohteina esim. erittäin arkaluontoinen taloudellinen tai kansallinen tietoturva
    - hyökkäysketju (kill chain) koostuu 7 eri askeleesta: tiedustelu (recoinnasance), varustelu (weaponization), jakelu (delivery), hyväksikäyttö (exploitation), asennus (installation), komento ja hallinta (command and control) sekä tavoitetoimet (actions and objectives)
    - hyökkäyksiltä puolustautuvan täytyy pystyä siirtämään havaitsemista hyökkäysketjussa ylöspäin, ja toteuttaa laajoja toimia koko hyökkäysketjun poikki

### a) Ratkaise *[Over The Wire: Bandit](https://overthewire.org/wargames/bandit/https://overthewire.org/wargames/bandit/)* kolme ensimmäistä tasoa (0-2).

Aloitin tehtävät asentamalla ssh clientin, koska kokeillessani ssh-yhteyskomentoa sain vastauksen "bash: ssh: command not found". Näin ollen:

```console
$ sudo apt-get install openssh-client
$ ssh bandit0@bandit.labs.overthewire.org -p 2220
```

Yhteys lähti toimimaan, sillä kirjautuminen vaati salasanaa. 0-tason salasana oli annettu verkkosivulle valmiiksi, joten pääsin kirjautumaan sisään. Vihjeissä luki, että tasolle 1 päästäkseen täytyy löytää readme-tiedosto, joka sisältää salasanan. Annoin komennon ls, jotta sain kaikki sisällöt näkyviin. Komento näytti vain yhden tiedoston readme. 
Sen jälkeen ```cat readme```, ja kopion tiedostossa sijainneen salasanan. Tämän jälkeen katkaisin ssh-yhteyden ```ctrl + d```, ja vaihdoin yhteyden käyttäjäksi bandit1. Pääsin sisään kopiomallani salasanalla:

Tasolla 1 sijaitsi vain yksi tiedosto nimellä "-". Vaikka arvasin, että tehtävä ei ole näin suoraviivainen, kokeilin komennot:

```console
$ cat -
$ nano -
```

Näillä tiedoston avaaminen ei onnistunut. Tarkistin [stackoverflow:sta](https://stackoverflow.com/questions/42187323/how-to-open-a-dashed-filename-using-terminal) miten dash-tiedosto avataan. Stackoverflow:n vastauksen mukaan tiedoston sijainti täytyy ilmoittaa cat komennon yhteydessä. 
Eli ```cat ./-``` tuotti tulosta ja sain salasanan avattua & kopioitua. Katkaisin ssh yhteyden, ja lähdin yhdistämään bandit2-tunnuksella. Pääsin sisään.

![bandit2](https://github.com/jjenska/PenTest/assets/105623785/5ca4e224-c987-4f80-841f-25d9603b866a)

### b) Ratkaise Challenge.fi:stä yksi tehtävä.

Valitsin [Challenge 2022 tehtävän](https://2022.challenge.fi/challenges#Antagonist's%20artistic%20ancestor-4) OSINT Antagonists's artistic ancestor 167. Vihjeeksi oli annettu agentti (licensed to kill) ja kuva unknown.png. Kuvassa oleva laite on esiintynyt tietyssä Bond elokuvassa. Tämän leffan antagonistin näyttelijä on kuuluisan taidemaalarin pojanpoika. Taiteilijaisoisä kuului
taideseuraan, jonka rakennuksen nykyistä osoitetta haettiin vastaukseksi. 

Latasin liitetyn kuvatiedoston ja googletin reversed image search, jotta löytäisin, missä yhteydessä kuvaa internetissä esiintyy. Työkaluksi valikoitui [TinEye](https://tineye.com/), ja jo ensimmäinen hakutulos paljasti Bond-elokuvan nimeksi The Living Daylights (1987). Googlettamalla leffan antagonisti, löytyi näyttelijä [Jeroen Krabbé](https://en.wikipedia.org/wiki/Jeroen_Krabb%C3%A9). Wikipedia
kertoi yhteyden taidemaalari isoisään Hendrik Maarten Krabbé. Hän kuului hollantilaiseen taideseuraan nimeltä Arti et Amicitiae. Google maps antoi rakennukselle osoitteen Spui ilman numeroa, mutta [Tripadvisorista](https://www.tripadvisor.com/Attraction_Review-g188590-d12350144-Reviews-Arti_et_Amicitiae-Amsterdam_North_Holland_Province.html) löytyi rakennuksen toisen sivun katu Rokin, ja as. numero 112. Oletin oikean vastauksen olevan GENZ{Rokin_112}.
Sivusto olisi vaatinut käyttäjätunnuksen luomisen, sitä en tehnyt.

### c) Ratkaise *[PortSwigger Labs: Lab: SQL injection vulnerability in WHERE clause allowing retrieval of hidden data](https://portswigger.net/web-security/sql-injection/lab-retrieve-hidden-data)*

Loin sivustolle käyttäjätunnuksen ja kirjauduin sisään labraan. Kertasin sivulta löytyvää materiaalia SQL-injektiosta, koska sen testaamista sivuttiin lyhyesti tietoturvan perusteet -kurssilla. Labran ratkaisu valitettavasti selvisikin heti dokumentaatiosta. Kun osoiterivin parametria category manipuloi muotoon ```/filter?category=Accessories'+OR+1=1--``` sai näkyviin kaikki julkaisemattomat tuotteet. Vinkkinä tehtävään annettiin SQL kysely:

> SELECT * FROM products WHERE category = 'Gifts' AND released = 1

Injektiossa 1=1 toteutuu aina, ja "--" kommentoi SQL-kielessä loput pois.

### d) Asenna Linux virtuaalikoneeseen

Aloitin tehtävien teon asentamalla ensin virtuaalikoneen Debian 12 käyttöjärjestelmällä [terokarvinen.com](https://terokarvinen.com/2021/install-debian-on-virtualbox/) ohjeiden mukaan. VirtualBox minulla oli jo valmiiksi asennettuna, joten tein ainoastaan päivitykset ja lisäsin "new machine" tyyppinä Linux ja käyttöjärjestelmänä Debian (64-bit). Muistiksi asetin 4000MB ja virtuaalisen kovalevyn kooksi 60GB. Latasin ISO imagen (debian-live-12.2.0-amd64-xfce.iso), ja syötin sen asemaan. Tämän jälkeen käynnistin koneen, ja pienen odottelun jälkeen sain työpöydän aukeamaan.

Testasin ohjeiden mukaan näppäimistön, hiiren ja yhteyden toimivuuden selaimen kautta hs.fi. Tämän jälkeen ajoin Debianin installerin, ja asetin kielen, aikavyöhykkeen ja host & käyttäjätiedot. Asennuksen jälkeen boottaus onnistui ja sain kirjautumisikkunan näkyviin. Päivittääkseni kaikki paketit ja riippuvuudet, sekä aktivoidakseni palomuurin, ajoin komennot:

```console
$ sudo apt-get update
$ sudo apt-get -y dist-upgrade
$ sudo apt-get -y install ufw
$ sudo ufw enable
```
Tämän jälkeen boottasin vielä koneen.

### e) Porttiskannaa 1000 tavallisinta tcp-porttia omasta koneestasi (localhost). Analysoi tulokset.

Aloitin tehtävän asentamalla Nmap:n virtuaalikoneelleni. Tämän jälkeen tarkistin vielä version.

```console
$ sudo apt-get -y install nmap
$ nmap -V
```

Koska Nmap oli itselleni täysin uusi työkalu, tutustuin ensin heidän verkkosivuilta löytyvään [dokumentaatioon](https://nmap.org/book/toc.html). Sieltä
löytyi kirja, jossa oli kattava sisältö ilmaiseksi. Tehtävää varten selvitin, että komennolla ```-sT``` Nmap skannaa automaattisesti 1000 yleisintä tcp-porttia [Nmap: Port-scanning options](https://nmap.org/book/port-scanning-options.html). 
Näin ollen ajoin: ```nmap -sT localhost ```
Skannauksen tuloksena sain:

![nmapScan1000tcp](https://github.com/jjenska/PenTest/assets/105623785/119a5fe2-79c0-479c-a569-78d17d23c7f4)

Skannauksen mukaan localhost oli ylhäällä IP 127.0.0.1. Ainoastaan 2 tcp-porttia oli avoinna: 25, protokollana stmp (Simple Mail Transfer Protocol) ja 631, protokollana ipp (Internet Printing Protocol). Loput 998 porttia olivat kiinni. Skannaus oli hyvin tehokas, aikaa kului 0.04 sekuntia.

### f) Porttiskannaa kaikki koneesi (localhost) tcp-portit. Analysoi tulokset ja keskity edellisen kohdan eroihin.

Koska ```-sT``` komento skannaa ainoastaa 1000 yleisintä tcp-porttia, voidaan käyttää ```-p-```, joka jättää huomiotta alkupisteen ja loppupisteen
skannatakseen kaiken (lukuunottamatta porttia 0). [Nmap: Port-scanning options](https://nmap.org/book/port-scanning-options.html)

```console
$ nmap -p- localhost
```
Skannauksen tulos:

![nmapAll](https://github.com/jjenska/PenTest/assets/105623785/0ef057fc-8ef4-433e-a4fd-673dd0a2e810)

Nmap porttiskannasi yhteensä 65_535 porttia, joista suljettuina oli 65_533. Avoimena olivat samat portit.

### g) Tee laaja porttiskannaus (nmap -A) localhostille. Selitä, mitä -A tekee. Analysoi tulokset.

Nmap:n ohjekirjan mukaan (```man nmap```) ```-A``` syntyy termistä Aggressive scan options. Se siis mahdollistaa edistyneiden ja
aggressiivisten lisäkeinojen hyödyntämisen. Komento aktivoi käyttöjärjestelmän tunnistamisen (```-O```), version skannaamisen (```-sV```), skriptien
skannaamisen (```-sC```) sekä paketin reitin kulun jäljittämisen (```--traceroute```). Sen tarkoitus on tarjota yksinkertainen "kytkin" skannaamiselle,
ilman että käyttäjän tarvitsee muistaa useita erillisiä komentoja.

Kokeilin skannausta:

```console
$ nmap -A -p- localhost
```

![nmap A scan1](https://github.com/jjenska/PenTest/assets/105623785/744140de-5694-48f9-9d11-7d2ac123a94b)

Tulos näytti mm. kaikkien porttien palveluiden versiot sekä virtuaalikoneeni host-nimen: hhpt. Tässä vaiheessa huomasin, että Nmap ei listannut ollenkaan 
käyttöjärjestelmän tietoja. Olin jo aikaisemmin pohtinut, että jotkin skannattavat ominaisuudet saattavat vaatia pääkäyttäjän vaatimuksia. 
Toki, jos tarkastelee tcp porttia 631, löytyy tieto CUPS (common Unix Printing System), joka viittaisi Linux tai Mac käyttöjärjestelmään. 
Kokeilin kuitenkin komennon uudestaan pääkäyttäjän oikeuksilla:

```console
$ sudo nmap -A -p- localhost
```
![nmap A scan2](https://github.com/jjenska/PenTest/assets/105623785/09cd026e-16c6-4f99-88b0-2c210199aeaf)

Näin tulokseen listautui myös käyttöjärjestelmän tiedot.

### h) Asenna ja käynnistä jokin palvelin koneellesi. Vertaa miten porttiskannauksen tulos eroaa.

Päätin asentaa Apache2-palvelimen, sillä se oli tuttu jo aikaisemmalta Linux-palvelimet kurssilta. Asennus- ja käynnistyskomennot olivat vielä muistissa:

```console
$ sudo apt-get -y install apache2
$ sudo systemctl start apache2
```

Avasin selaimen kautta localhostin, varmistaakseni, että palvelin on pystyssä. Apachen testisivu tuli näkyviin, joten palvelin toimi kuten kuuluukin.
Tämän jälkeen tein suppeamman tcp-porttiskannauksen (```nmap -sT localhost```), jonka tuloksena protokolliin ilmestyi myös http portissa 80. Laajemmalla skannauksella (```sudo nmap -A localhost```) sain näkyviin myös Apachen versionumeron. Lisäksi skannaus näytti, että palvelimen oletus http-sivua ei oltu vaihdettu (Default Page: It works). Apachen avulla skannauksessa nousi esiin myös Debianin käyttö. Testiksi kokeilin vielä sammuttaa palvelimen ```sudo systemctl stop apache2```, jolloin portti 80 sulkeutui.

![apche2_Ascan](https://github.com/jjenska/PenTest/assets/105623785/1f4650a6-26b9-460a-9bb2-f6b6fc765455)

### i) Kokeile ja esittele jokin avointen lähteiden tiedusteluun sopiva weppisivu tai työkalu. Työkalua pitää siis myös kokeilla, pelkkä nimen mainitseminen ei riitä. Pidä esimerkit harmittomina, älä julkaise kenenkään henkilökohtaisia salaisuuksia raportissasi.

Katselin [The Cyber Mentorin](https://www.youtube.com/watch?v=qwA6MmbeGNo) videota, jossa oli erittäin kattavasti esitelty erilaisia avointen lähteiden tiedustelupalveluita. Nappasin videon mielenkiintoisesta kohdasta "voter records" sivuston [voterrecords.com](https://voterrecords.com/). Kyseiseltä sivulta pystyi saamaan Yhdysvaltojen osavaltioittain tietoa äänestäjistä. Klikkasin Arkansas'n kuvaketta, jonka jälkeen aukesi lista nimiä, osoitteita ja äänestysoikeusalueita kyseisessä osavaltiossa.

![voters](https://github.com/jjenska/PenTest/assets/105623785/30f1bbe3-4310-4f78-b492-1f4548d6985b)
![votersstate](https://github.com/jjenska/PenTest/assets/105623785/221f883a-92dc-4483-9aad-dade8720cbbe)

## Lähteet:

[Challenge2022](https://2022.challenge.fi/challenges)

[Nmap - Port Scanning Options](https://nmap.org/book/port-scanning-options.html)

[Nmap - The Official Nmap Project Guide to Network Discovery and Security Scanning](https://nmap.org/book/toc.html)

[Overthewire - Bandit wargame](https://overthewire.org/wargames/bandit/bandit0.html)

[Portswigger - Sql injection lab](https://portswigger.net/web-security/sql-injection/lab-retrieve-hidden-data)

[terokarvinencom - Ethical hacking course material](https://terokarvinen.com/2023/eettinen-hakkerointi-2023/#h1-hacker-warmup)

[terokarvinencom - Installing Debian on VirtualBox](https://terokarvinen.com/2021/install-debian-on-virtualbox/)

[The Cyber Mentor - OSINT - Youtube](https://www.youtube.com/watch?v=qwA6MmbeGNo)
